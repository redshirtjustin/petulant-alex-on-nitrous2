<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Story
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!Story.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (S)</a> &raquo;
    
    
    <span class="title">Story</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Story
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">Story</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">ActionView::Helpers</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">app/models/story.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>validates_uniqueness_of :position, scope: :story_id</p>
</div>
  </div>


<h2 id="label-Story+Class">Story Class</h2>

<p>A story object is a special container that has connecting headlines,
leadlines, and story elements that are ordered in the &#39;Positions
Stack&#39; or pstack.</p>

<h3 id="label-The+idea+in+an+English+Nutshell">The idea in an English Nutshell</h3>

<p>It was intended that a story written about some news topic would best be
consumed in index card size segments. The index cards (elements) would
convey an unbiased fact about some aspect of the story. New cards could be
added to the container/story as the topic developed.</p>

<p>To facilitate this index card style story, there are some accompanying
concepts.</p>

<h2 id="label-Story+Attributes">Story Attributes</h2>

<p>Section - all stories belong to a single category</p>

<p>Subject - the main topic of the story, limited to 140 characters</p>

<p>Active Headline - A story can own an increasing number of headlines, so as
the story develops new 				headlines can capture the developing facts.
Also, when displayed in chronological  				fashion, the headlines will read
like a developing story timeline. There are a few 				methods that work
with the active headline, and there are a few methods that return 				the
chronology of the headlines.</p>

<p>There are not a lot of delete features because stories should be
treated not as  				in drafts, but rather an organic developing topic, it
is preferred that authors 				make inactive headlines, leadlines, and
elements rather than delete, for posterity.</p>

<p>Active Leadline - See Active Headline.. difference: Leadlines are limited
to 555 characters.</p>

<h2 id="label-Story+elements">Story elements</h2>

<p>Currently there are only two elements. SimpleContent and QuoteContent</p>

<p>Elements compose the majority of content displayed in a story. Each class
of element tackles a particular focus.</p>

<p>SimpleContent - Should focus on delievering a singular fact with some
supporting or detailing 				descriptions. (Explore the semantics of a terse
and effective element elsewhere.) A 				topic attribute, limited to 140
characters, is supplied. A content attribute, 				limited to 555 characters
is supplied.</p>

<p>QuoteContent -  This is an expanded SimpleContent element, with attributes
for Quote, Quotee name, 				and Quotee title, as well as the attributes of
a SimpleContent. (Quote and content 				should work together, and not
duplicate meaning. e.g. an army general quoted about 				a warzone can be
supplemented with facts about the warzone. etc.)</p>

<p>More elements should be created, but not today. ImageContent for photos and
possibly info-graphics, MapContent, and AudioContent</p>

<h2 id="label-Positions">Positions</h2>

<p>Elements are associated to a position of their own in the pstack. The
pstack orders the elements in a way according to the flow of the story, and
the desire of the author and her choice of composition. Position 1 is the
topmost position, position n is the last. There is no actual pstack object,
instead there is just a recording of the every position associated with
every story, in  one big table. A story&#39;s pstack is the extraction of
only those positions that are associated with that story. Every element
attached to those positions are combined and considered the pstack. The 
Position model is set to</p>

<p>so there should be no duplicate positions for a story.</p>

<p>Positions have an active attribute, boolean. Set to true to allow the
public to view that position, and set to false to keep it hidden.</p>

<p>** (not yet implemented) Each position can have multiple associations to
other stories. It is intended to associate the content of the element to
another related story. It&#39;s an imperfect implementation since if the
element attached to a position was replaced, it could possibly not make
contextual sense. Be aware of context.</p>

<p>The difference between &#39;similar stories&#39; and &#39;related
stories&#39; is necessary. In this context,  similar stories are considered
close in subject but not expansive. e.g. &#39;Satellite rocketed into 
Space&#39; is similar to &#39;International Effort to Save Astronauts
Underway&#39; both are similar in the  subject: Science/Space. Whereas,
&#39;International Effort to Save Astronauts Underway&#39; and &#39;Debris 
Cripples International Space Station&#39; are related stories. Typically,
positions will carry related  story references since they go to expand on
the overarching themes. Stories can be directly  connected to other similar
stories.</p>

<h2 id="label-Citations">Citations</h2>

<p>Simple citations, only to web references, requiring a title of the webpage,
and a url. All elements should have at least one citation, but this should
be discussed in some sort of authoring guidelines documentations.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#active_headline_id-instance_method" title="#active_headline_id (instance method)">- (Object) <strong>active_headline_id</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>References the headline used atop the story.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#active_leadline_id-instance_method" title="#active_leadline_id (instance method)">- (Object) <strong>active_leadline_id</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>References the leadline used atop the story.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#section_id-instance_method" title="#section_id (instance method)">- (Object) <strong>section_id</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Categorized under this section.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#subject-instance_method" title="#subject (instance method)">- (Object) <strong>subject</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shorty describes this story.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Age and Freshness methods
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#age-instance_method" title="#age (instance method)">- (String) <strong>age</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The age in words.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#freshness-instance_method" title="#freshness (instance method)">- (String) <strong>freshness</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The freshness in words.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_date_created-instance_method" title="#get_date_created (instance method)">- (TimeWithZone) <strong>get_date_created</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The timedate when the citation was created.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_date_updated-instance_method" title="#get_date_updated (instance method)">- (TimeWithZone) <strong>get_date_updated</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The timedate when the citation was created.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Getters and Setters of descriptive attributes
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#filed_under%3F-instance_method" title="#filed_under? (instance method)">- (String) <strong>filed_under?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>What Section is this Story filed under?.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_subject-instance_method" title="#get_subject (instance method)">- (String) <strong>get_subject</strong> </a>
    

    
      (also: #about)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the subject of the story.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_section-instance_method" title="#set_section (instance method)">- (Boolean) <strong>set_section</strong>(section_id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the section_id of this story.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_subject-instance_method" title="#set_subject (instance method)">- (Boolean) <strong>set_subject</strong>(new_subject) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the subject to a new subject and then saves.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      headline methods
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#active_headline_age-instance_method" title="#active_headline_age (instance method)">- (String) <strong>active_headline_age</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The age of the active headline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#active_headline_freshness-instance_method" title="#active_headline_freshness (instance method)">- (String) <strong>active_headline_freshness</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The freshness of the active headline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#freshest_headline-instance_method" title="#freshest_headline (instance method)">- (String) <strong>freshest_headline</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the most recently updated headline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_active_headline-instance_method" title="#get_active_headline (instance method)">- (String) <strong>get_active_headline</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The active headline of the story.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_active_headline_id-instance_method" title="#get_active_headline_id (instance method)">- (Integer) <strong>get_active_headline_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The active headline id of the story.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#headlines_by_freshness-instance_method" title="#headlines_by_freshness (instance method)">- (ActiveCollection) <strong>headlines_by_freshness</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns all headlines from the freshest to the stalest.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#headlines_by_staleness-instance_method" title="#headlines_by_staleness (instance method)">- (ActiveCollection) <strong>headlines_by_staleness</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns all headlines from the stalest to the freshest.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#headlines_oldest_to_youngest-instance_method" title="#headlines_oldest_to_youngest (instance method)">- (ActiveCollection) <strong>headlines_oldest_to_youngest</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return all headlines in order from the oldest to the youngest.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#headlines_youngest_to_oldest-instance_method" title="#headlines_youngest_to_oldest (instance method)">- (ActiveCollection) <strong>headlines_youngest_to_oldest</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return all headlines from the youngest to oldest.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_headline-instance_method" title="#new_headline (instance method)">- (Boolean) <strong>new_headline</strong>(new_headline, make_active = true) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new headline for this story.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#oldest_headline-instance_method" title="#oldest_headline (instance method)">- (String) <strong>oldest_headline</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the first created headline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_active_headline-instance_method" title="#set_active_headline (instance method)">- (Boolean) <strong>set_active_headline</strong>(id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set the active to a headline that already exists using its id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stalest_headline-instance_method" title="#stalest_headline (instance method)">- (String) <strong>stalest_headline</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the oldest updated headline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#youngest_headline-instance_method" title="#youngest_headline (instance method)">- (String) <strong>youngest_headline</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the last created headline.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      leadline methods
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#active_leadline_age-instance_method" title="#active_leadline_age (instance method)">- (String) <strong>active_leadline_age</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The age of the active leadline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#active_leadline_freshness-instance_method" title="#active_leadline_freshness (instance method)">- (String) <strong>active_leadline_freshness</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The freshness of the active leadline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#freshest_leadline-instance_method" title="#freshest_leadline (instance method)">- (String) <strong>freshest_leadline</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the most recently updated leadline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_active_leadline-instance_method" title="#get_active_leadline (instance method)">- (String) <strong>get_active_leadline</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The active leadline of the story.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_active_leadline_id-instance_method" title="#get_active_leadline_id (instance method)">- (Integer) <strong>get_active_leadline_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The active leadline id of the story.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#leadlines_by_freshness-instance_method" title="#leadlines_by_freshness (instance method)">- (ActiveCollection) <strong>leadlines_by_freshness</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns all leadlines from the freshest to the stalest.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#leadlines_by_staleness-instance_method" title="#leadlines_by_staleness (instance method)">- (ActiveCollection) <strong>leadlines_by_staleness</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns all leadlines from the stalest to the freshest.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#leadlines_oldest_to_youngest-instance_method" title="#leadlines_oldest_to_youngest (instance method)">- (ActiveCollection) <strong>leadlines_oldest_to_youngest</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return all leadlines in order from the oldest to the youngest.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#leadlines_youngest_to_oldest-instance_method" title="#leadlines_youngest_to_oldest (instance method)">- (ActiveCollection) <strong>leadlines_youngest_to_oldest</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return all leadlines from the youngest to oldest.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_leadline-instance_method" title="#new_leadline (instance method)">- (Boolean) <strong>new_leadline</strong>(new_leadline, make_active = true) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new leadline for this story.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#oldest_leadline-instance_method" title="#oldest_leadline (instance method)">- (String) <strong>oldest_leadline</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the first created leadline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_active_leadline-instance_method" title="#set_active_leadline (instance method)">- (Boolean) <strong>set_active_leadline</strong>(id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set the active to a leadline that already exists using its id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stalest_leadline-instance_method" title="#stalest_leadline (instance method)">- (String) <strong>stalest_leadline</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the oldest updated leadline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#youngest_leadline-instance_method" title="#youngest_leadline (instance method)">- (String) <strong>youngest_leadline</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the last created leadline.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Position Stack (pstack) manipulation
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#activate_pstack-instance_method" title="#activate_pstack (instance method)">- (True) <strong>activate_pstack</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Activates all the positions of this story.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#append-instance_method" title="#append (instance method)">- (Boolean) <strong>append</strong>(element) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds an position with and element to the end of the pstack.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#chop-instance_method" title="#chop (instance method)">- (Nil, True) <strong>chop</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Removes the first position on the pstack, or returns nil if the pstack is
empty.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_active_pstack_backwards-instance_method" title="#get_active_pstack_backwards (instance method)">- (ActiveCollection) <strong>get_active_pstack_backwards</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The pstack with only active positions, in descending order.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_active_pstack_forwards-instance_method" title="#get_active_pstack_forwards (instance method)">- (ActiveCollection) <strong>get_active_pstack_forwards</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The pstack with only active positions, in ascending order.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_inactive_pstack_backwards-instance_method" title="#get_inactive_pstack_backwards (instance method)">- (ActiveCollection) <strong>get_inactive_pstack_backwards</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The pstack with only inactive positions, in descending order.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_inactive_pstack_forwards-instance_method" title="#get_inactive_pstack_forwards (instance method)">- (ActiveCollection) <strong>get_inactive_pstack_forwards</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The pstack with only inactive positions, in ascending order.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_pstack_backwards-instance_method" title="#get_pstack_backwards (instance method)">- (ActiveCollection) <strong>get_pstack_backwards</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The whole pstack in descending order.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_pstack_forwards-instance_method" title="#get_pstack_forwards (instance method)">- (ActiveCollection) <strong>get_pstack_forwards</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The whole pstack in ascending order.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inactivate_pstack-instance_method" title="#inactivate_pstack (instance method)">- (True) <strong>inactivate_pstack</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Inactivates all the positions of this story.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is_pstack_consistent%3F-instance_method" title="#is_pstack_consistent? (instance method)">- (Boolean) <strong>is_pstack_consistent?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Determines if the pstack is in compact order.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#make_pstack_consistent-instance_method" title="#make_pstack_consistent (instance method)">- (Boolean) <strong>make_pstack_consistent</strong>(start = 1) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Makes the pstack consistent.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pop-instance_method" title="#pop (instance method)">- (Nil, True) <strong>pop</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Removes the last position on the pstack, or returns nil if the pstack is
empty.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#push-instance_method" title="#push (instance method)">- (Boolean) <strong>push</strong>(element) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds an position with and element to the beginning of the pstack.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_pstack_order-instance_method" title="#set_pstack_order (instance method)">- (Nil, True) <strong>set_pstack_order</strong>(order) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reorders the pstack in the order of an array of position ids.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shift-instance_method" title="#shift (instance method)">- (Object) <strong>shift</strong>(modifier) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shift all the positions in the pstack by the modifier.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Content Aggregation
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_citations-instance_method" title="#get_citations (instance method)">- (Array) <strong>get_citations</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns and array of all the citations that are attached through positions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_similar_stories-instance_method" title="#get_similar_stories (instance method)">- (ActiveCollection) <strong>get_similar_stories</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Alias for self.relations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_similar_story-instance_method" title="#new_similar_story (instance method)">- (Boolean) <strong>new_similar_story</strong>(story_id_to_connect_to) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>True if save is successful, false if save is unsuccessful, if similar story
is already a similiar story, or if similiar story and self are the same.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_similar_story-instance_method" title="#remove_similar_story (instance method)">- (Boolean) <strong>remove_similar_story</strong>(story_id_to_remove) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Destroys the connection between self and the similar story.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="active_headline_id=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="active_headline_id-instance_method">
  
    - (<tt>Object</tt>) <strong>active_headline_id</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>References the headline used atop the story.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 96</span>

<span class='kw'>class</span> <span class='const'>Story</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'>ActionView</span><span class='op'>::</span><span class='const'>Helpers</span>
    
    <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbol'>:section</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:headlines</span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:leadlines</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:positions</span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:simple_contents</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:positions</span><span class='comma'>,</span> <span class='label'>source:</span> <span class='symbol'>:element</span><span class='comma'>,</span> <span class='label'>source_type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SimpleContent</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:quote_contents</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:positions</span><span class='comma'>,</span> <span class='label'>source:</span> <span class='symbol'>:element</span><span class='comma'>,</span> <span class='label'>source_type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>QuoteContent</span><span class='tstring_end'>&#39;</span></span>
    
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:simple_content_citations</span><span class='comma'>,</span> <span class='symbol'>:through</span> <span class='op'>=&gt;</span> <span class='symbol'>:simple_contents</span><span class='comma'>,</span> <span class='symbol'>:source</span> <span class='op'>=&gt;</span> <span class='symbol'>:citations</span> 
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:quote_content_citations</span><span class='comma'>,</span> <span class='symbol'>:through</span> <span class='op'>=&gt;</span> <span class='symbol'>:quote_contents</span><span class='comma'>,</span> <span class='symbol'>:source</span> <span class='op'>=&gt;</span> <span class='symbol'>:citations</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:relations</span>
    
    <span class='id identifier rubyid_validates'>validates</span> <span class='symbol'>:subject</span><span class='comma'>,</span> <span class='symbol'>:section_id</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_validates'>validates</span> <span class='symbol'>:subject</span><span class='comma'>,</span> <span class='label'>length:</span> <span class='lbrace'>{</span> <span class='label'>maximum:</span> <span class='int'>140</span> <span class='rbrace'>}</span>
    
    <span class='comment'>#@!group Age and Freshness methods
</span>    
    <span class='comment'># @!method get_date_created
</span>    <span class='comment'># @return [TimeWithZone] the timedate when the citation was created
</span>    <span class='comment'># @example 
</span>    <span class='comment'>#     kat.get_date_created =&gt; Mon, 09 Feb 2015 15:18:20 UTC +00:00
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_date_created'>get_date_created</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_date_updated
</span>    <span class='comment'># @return [TimeWithZone] the timedate when the citation was created
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    kat.get_date_updated =&gt; Mon, 09 Feb 2015 15:31:29 UTC +00:00
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_date_updated'>get_date_updated</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_updated_at'>updated_at</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method age
</span>    <span class='comment'># The age in words. Time from creation until now.
</span>    <span class='comment'># @return [String]
</span>    <span class='comment'># @example
</span>    <span class='comment'>#     cit.age =&gt; &quot;about 16 hours&quot;
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_age'>age</span>
        <span class='id identifier rubyid_time_ago_in_words'>time_ago_in_words</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_date_created'>get_date_created</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshness
</span>    <span class='comment'># The freshness in words. Time from last updated until now.
</span>    <span class='comment'># @return [String]
</span>    <span class='comment'># @example
</span>    <span class='comment'>#     hl.freshness =&gt; &quot;6 minutes&quot;
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshness'>freshness</span>
        <span class='id identifier rubyid_time_ago_in_words'>time_ago_in_words</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_date_updated'>get_date_updated</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Getters and Setters of descriptive attributes
</span>    
    <span class='comment'># @!method get_subject
</span>    <span class='comment'># Returns the subject of the story. A short description of the story, helping authors.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_subject'>get_subject</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method about
</span>    <span class='comment'># Alias for get_subject
</span>    <span class='comment'># @return [String]
</span>    <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:about</span><span class='comma'>,</span> <span class='symbol'>:get_subject</span>
    
    <span class='comment'># @!method set_subject(new_subject)
</span>    <span class='comment'># Sets the subject to a new subject and then saves.
</span>    <span class='comment'># @param [String] new_subject
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_subject'>set_subject</span> <span class='lparen'>(</span><span class='id identifier rubyid_new_subject'>new_subject</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_new_subject'>new_subject</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method filed_under?
</span>    <span class='comment'># What Section is this Story filed under?
</span>    <span class='comment'># @return [String] the section title of the owning Section
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_filed_under?'>filed_under?</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method set_section(section_id)
</span>    <span class='comment'># Sets the section_id of this story
</span>    <span class='comment'># @param [Integer] section_id
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_section'>set_section</span><span class='lparen'>(</span><span class='id identifier rubyid_section_id'>section_id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_section_id'>section_id</span> <span class='op'>=</span> <span class='id identifier rubyid_section_id'>section_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group headline methods
</span>    
    <span class='comment'># @!method get_active_headline
</span>    <span class='comment'># The active headline of the story.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_headline'>get_active_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_active_headline_id
</span>    <span class='comment'># The active headline id of the story.
</span>    <span class='comment'># @return [Integer] the id of the active headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_headline_id'>get_active_headline_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_headline_age
</span>    <span class='comment'># The age of the active headline. Time from creation until now.
</span>    <span class='comment'># @return [String] the age in words
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_headline_age'>active_headline_age</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_age'>age</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_headline_freshness
</span>    <span class='comment'># The freshness of the active headline. From last updated until now.
</span>    <span class='comment'># @return [String] the freshness in words 
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_headline_freshness'>active_headline_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freshness'>freshness</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method set_active_headline(id)
</span>    <span class='comment'># Set the active to a headline that already exists using its id. And saves it to the database.
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_active_headline'>set_active_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>   
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_headline(new_headline, make_active=true)
</span>    <span class='comment'># Create a new headline for this story. make_active true/false, true makes
</span>    <span class='comment'>#   this new headline the active one.
</span>    <span class='comment'># @return [Boolean] if save is successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_headline'>new_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_new_headline'>new_headline</span><span class='comma'>,</span> <span class='id identifier rubyid_make_active'>make_active</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_kat'>kat</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>content:</span> <span class='id identifier rubyid_new_headline'>new_headline</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_make_active'>make_active</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_active_headline'>set_active_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_kat'>kat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_oldest_to_youngest
</span>    <span class='comment'># Return all headlines in order from the oldest to the youngest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_oldest_to_youngest'>headlines_oldest_to_youngest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_youngest_to_oldest
</span>    <span class='comment'># Return all headlines from the youngest to oldest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_youngest_to_oldest'>headlines_youngest_to_oldest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>        
    <span class='kw'>end</span>

    <span class='comment'># @!method oldest_headline
</span>    <span class='comment'># Returns the first created headline.
</span>    <span class='comment'># @return [String] the oldest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_oldest_headline'>oldest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method youngest_headline
</span>    <span class='comment'># Returns the last created headline.
</span>    <span class='comment'># @return [String] the youngest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_youngest_headline'>youngest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshest_headline
</span>    <span class='comment'># Returns the most recently updated headline.
</span>    <span class='comment'># @return [String] the freshest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshest_headline'>freshest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method stalest_headline
</span>    <span class='comment'># Returns the oldest updated headline.
</span>    <span class='comment'># @return [String] the stalest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_stalest_headline'>stalest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_by_freshness
</span>    <span class='comment'># Returns all headlines from the freshest to the stalest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_by_freshness'>headlines_by_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>    
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_by_staleness
</span>    <span class='comment'># Returns all headlines from the stalest to the freshest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_by_staleness'>headlines_by_staleness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group leadline methods
</span>    
    <span class='comment'># @!method get_active_leadline
</span>    <span class='comment'># The active leadline of the story.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_leadline'>get_active_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_active_leadline_id
</span>    <span class='comment'># The active leadline id of the story.
</span>    <span class='comment'># @return [Integer] the id of the active leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_leadline_id'>get_active_leadline_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_leadline_age
</span>    <span class='comment'># The age of the active leadline. Time from creation until now.
</span>    <span class='comment'># @return [String] the age in words
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_leadline_age'>active_leadline_age</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_age'>age</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_leadline_freshness
</span>    <span class='comment'># The freshness of the active leadline. From last updated until now.
</span>    <span class='comment'># @return [String] the freshness in words 
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_leadline_freshness'>active_leadline_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freshness'>freshness</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method set_active_leadline(id)
</span>    <span class='comment'># Set the active to a leadline that already exists using its id. And saves it to the database.
</span>    <span class='comment'># @param [Integer] id
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_active_leadline'>set_active_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>   
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_leadline(new_leadline, make_active=true)
</span>    <span class='comment'># Create a new leadline for this story. make_active true/false, true makes
</span>    <span class='comment'>#   this new leadline the active one.
</span>    <span class='comment'># @return [Boolean] if save is successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='comma'>,</span> <span class='id identifier rubyid_make_active'>make_active</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_kat'>kat</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>content:</span> <span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_make_active'>make_active</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_active_leadline'>set_active_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_kat'>kat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_oldest_to_youngest
</span>    <span class='comment'># Return all leadlines in order from the oldest to the youngest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_oldest_to_youngest'>leadlines_oldest_to_youngest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_youngest_to_oldest
</span>    <span class='comment'># Return all leadlines from the youngest to oldest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_youngest_to_oldest'>leadlines_youngest_to_oldest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>        
    <span class='kw'>end</span>

    <span class='comment'># @!method oldest_leadline
</span>    <span class='comment'># Returns the first created leadline.
</span>    <span class='comment'># @return [String] the oldest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_oldest_leadline'>oldest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method youngest_leadline
</span>    <span class='comment'># Returns the last created leadline.
</span>    <span class='comment'># @return [String] the youngest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_youngest_leadline'>youngest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshest_leadline
</span>    <span class='comment'># Returns the most recently updated leadline.
</span>    <span class='comment'># @return [String] the freshest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshest_leadline'>freshest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method stalest_leadline
</span>    <span class='comment'># Returns the oldest updated leadline.
</span>    <span class='comment'># @return [String] the stalest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_stalest_leadline'>stalest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_by_freshness
</span>    <span class='comment'># Returns all leadlines from the freshest to the stalest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_by_freshness'>leadlines_by_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>    
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_by_staleness
</span>    <span class='comment'># Returns all leadlines from the stalest to the freshest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_by_staleness'>leadlines_by_staleness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Position Stack (pstack) manipulation        
</span>    
    <span class='comment'># @!method get_pstack_forwards
</span>    <span class='comment'># The whole pstack in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_pstack_forwards'>get_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_pstack_backwards
</span>    <span class='comment'># The whole pstack in descending order. 
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_pstack_backwards'>get_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_active_pstack_forwards
</span>    <span class='comment'># The pstack with only active positions, in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_pstack_forwards'>get_active_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_active_pstack_backwards
</span>    <span class='comment'># The pstack with only active positions, in descending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_pstack_backwards'>get_active_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_inactive_pstack_forwards
</span>    <span class='comment'># The pstack with only inactive positions, in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_inactive_pstack_forwards'>get_inactive_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_inactive_pstack_backwards
</span>    <span class='comment'># The pstack with only inactive positions, in descending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_inactive_pstack_backwards'>get_inactive_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method is_pstack_consistent?
</span>    <span class='comment'># Determines if the pstack is in compact order.
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    consistent: [1, 2, 3, 4, 5]
</span>    <span class='comment'>#    consistent: [15, 16, 17, 18, 19]
</span>    <span class='comment'>#    inconsistent: [3, 6, 9, 12, 34]
</span>    <span class='comment'>#    inconsistent: [3, 3, 3, 4, 5] (this shouldn&#39;t occur if validation is on)
</span>    <span class='comment'># @return [Boolean] answer to your question.        
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_is_pstack_consistent?'>is_pstack_consistent?</span>
        <span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        <span class='id identifier rubyid_len'>len</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        
        <span class='lparen'>(</span><span class='id identifier rubyid_last'>last</span> <span class='op'>-</span> <span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='id identifier rubyid_len'>len</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method make_pstack_consistent(start=1)
</span>    <span class='comment'># Makes the pstack consistent. This is really a helper utility, may never needs to be used,
</span>    <span class='comment'># and especially not outside the context of this object.
</span>    <span class='comment'># @param [Integer] start what number will the first position start at? default = 1
</span>    <span class='comment'># @return [Boolean] returns true on complete
</span>    <span class='comment'>#    returns false if the param was 0 or 1
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 5, 9, 23]
</span>    <span class='comment'>#    story.is_consistent? #=&gt; false
</span>    <span class='comment'>#    story.make_pstack_consistent #=&gt; true
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 3, 4, 5]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>&lt;=</span> <span class='int'>0</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
        
        <span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_is_pstack_consistent?'>is_pstack_consistent?</span>
            <span class='comment'># True it&#39;s in order, then do we need to shift it?
</span>            <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span> <span class='op'>==</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='comment'># nothing to do
</span>                <span class='kw'>return</span> <span class='kw'>true</span>
            <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span> <span class='op'>!=</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='comment'># TODO: shift it
</span>                <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>-</span> <span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
                <span class='kw'>return</span> <span class='kw'>true</span>
            <span class='kw'>end</span>
        <span class='kw'>else</span> <span class='comment'># not consistent
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='comment'># b/c each story.positions.position needs to be uniqe, we run into the issue of 
</span>                <span class='comment'># Validation failed: Position has already been taken
</span>                <span class='comment'># so, we&#39;ll set the order in negative numbers and just flip their signs
</span>                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
                <span class='id identifier rubyid_start'>start</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='kw'>end</span>
                <span class='comment'># now to switch back to positive positions
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> 
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method shift(modifier)
</span>    <span class='comment'># Shift all the positions in the pstack by the modifier. Irregardless of activeness
</span>    <span class='comment'># of the positions. modifier=1 would shift the pstack down 1, modifier=-1 would shift it up 1
</span>    <span class='comment'># @param [Integer] modifier the number to shift the positions
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 3, 4, 5]
</span>    <span class='comment'>#    story.shift(10)
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [11, 12, 13, 14, 15]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_modifier'>modifier</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_modifier'>modifier</span> <span class='op'>&gt;</span> <span class='int'>0</span> 
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_modifier'>modifier</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>            
        <span class='kw'>elsif</span> <span class='id identifier rubyid_modifier'>modifier</span> <span class='op'>&lt;</span> <span class='int'>0</span> 
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_modifier'>modifier</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>    
        <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method set_pstack_order(order)
</span>    <span class='comment'># Reorders the pstack in the order of an array of position ids. First id in the array becomes
</span>    <span class='comment'># the first position, the second id becomes the second, and so on.
</span>    <span class='comment'># @return [Nil] if there isn&#39;t the same number of elements in the array and pstack
</span>    <span class='comment'># @return [Nil] if the pstack position id&#39;s do not include exactly the id&#39;s in the array
</span>    <span class='comment'># @return [True] if successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_pstack_order'>set_pstack_order</span><span class='lparen'>(</span><span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span> 
            <span class='comment'>#determine if the supplied order ids are actually owned by the story
</span>            <span class='id identifier rubyid_pstack'>pstack</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span>
                <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_pstack'>pstack</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
                    <span class='kw'>return</span> <span class='kw'>false</span>
                <span class='kw'>end</span>
            <span class='kw'>end</span>
            <span class='comment'># set the pstack to the order
</span>            <span class='id identifier rubyid_position_order'>position_order</span> <span class='op'>=</span> <span class='int'>1</span>
            <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Position</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_position_order'>position_order</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
                <span class='id identifier rubyid_position_order'>position_order</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='kw'>end</span>
            <span class='comment'># now to switch back to positive positions
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reload'>reload</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> 
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method pop
</span>    <span class='comment'># Removes the last position on the pstack, or returns nil if the pstack is empty.
</span>    <span class='comment'># @return [Nil] empty pstack
</span>    <span class='comment'># @return [True] if operation was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_pop'>pop</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method chop
</span>    <span class='comment'># Removes the first position on the pstack, or returns nil if the pstack is empty.
</span>    <span class='comment'># @return [Nil] empty pstack
</span>    <span class='comment'># @return [True] if operation was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_chop'>chop</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method push (element)
</span>    <span class='comment'># Adds an position with and element to the beginning of the pstack. Shifts and makes consistent
</span>    <span class='comment'># the remaining of the pstack.
</span>    <span class='comment'># @param [SimpleContent, QuoteContent] element any element
</span>    <span class='comment'># @return [Boolean]    
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_element'>element</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
      
        <span class='comment'># @!method append(element)
</span>    <span class='comment'># Adds an position with and element to the end of the pstack. Makes consistent the pstack.
</span>    <span class='comment'># @param [SimpleContent, QuoteContent] element any element
</span>    <span class='comment'># @return [Boolean]             
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_append'>append</span> <span class='lparen'>(</span><span class='id identifier rubyid_element'>element</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_last_pos'>last_pos</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='id identifier rubyid_last_pos'>last_pos</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method inactivate_pstack
</span>    <span class='comment'># Inactivates all the positions of this story.
</span>    <span class='comment'># @return [True] no matter what, humph.
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_inactivate_pstack'>inactivate_pstack</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_inactivate'>inactivate</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method activate_pstack
</span>    <span class='comment'># Activates all the positions of this story.
</span>    <span class='comment'># @return [True] no matter what, humph.
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_activate_pstack'>activate_pstack</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_activate'>activate</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Content Aggregation
</span>        
    <span class='comment'># @!method get_similar_stories
</span>    <span class='comment'># Alias for self.relations
</span>    <span class='comment'># @return [ActiveCollection] a collection of all the stories tied to self
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_similar_stories'>get_similar_stories</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span>
    <span class='kw'>end</span>
                
    <span class='comment'># @!method get_citations
</span>    <span class='comment'># Returns and array of all the citations that are attached through positions.
</span>    <span class='comment'># @return [Array] all the citations associated through positions
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_citations'>get_citations</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_simple_content_citations'>simple_content_citations</span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_quote_content_citations'>quote_content_citations</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_similar_story(story_id_to_connect_to)
</span>            <span class='comment'># Creates a new tie between the parent story and a passed story id.
</span>    <span class='comment'># @param [Integer] story_id_to_connect_to is the story id to link to
</span>    <span class='comment'># @return [Boolean] true if save is successful, false if save is unsuccessful, if similar
</span>    <span class='comment'>#    story is already a similiar story, or if similiar story and self are the same
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_similar_story'>new_similar_story</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='rparen'>)</span>
        <span class='comment'># if the param is the same as self, or if param is aready connected to self
</span>        <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:tie_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>!=</span> <span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span> <span class='kw'>and</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='label'>tie_id:</span> <span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='comma'>,</span> <span class='label'>tie_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Story</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>else</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method remove_similar_story(story_id_to_remove)
</span>    <span class='comment'># Destroys the connection between self and the similar story
</span>    <span class='comment'># @param [Integer] story_id_to_remove the id of the tied story
</span>    <span class='comment'># @return [Boolean] true if the destroyed, false if not
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_remove_similar_story'>remove_similar_story</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:tie_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='const'>Relation</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>story_id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>tie_id:</span> <span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='comma'>,</span> <span class='label'>tie_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Story</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>else</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='comment'>#@!endgroup        
</span>       
<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:age</span><span class='comma'>,</span> <span class='symbol'>:freshness</span><span class='comma'>,</span> <span class='symbol'>:get_date_created</span><span class='comma'>,</span> <span class='symbol'>:get_date_updated</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:filed_under?</span><span class='comma'>,</span> <span class='symbol'>:get_subject</span><span class='comma'>,</span> <span class='symbol'>:about</span><span class='comma'>,</span> <span class='symbol'>:set_subject</span><span class='comma'>,</span> <span class='symbol'>:set_section</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_active_headline</span><span class='comma'>,</span> <span class='symbol'>:get_active_headline_id</span><span class='comma'>,</span> <span class='symbol'>:active_headline_age</span><span class='comma'>,</span> <span class='symbol'>:active_headline_freshness</span><span class='comma'>,</span> <span class='symbol'>:set_active_headline</span><span class='comma'>,</span> <span class='symbol'>:new_headline</span><span class='comma'>,</span> <span class='symbol'>:headlines_oldest_to_youngest</span><span class='comma'>,</span> <span class='symbol'>:headlines_youngest_to_oldest</span><span class='comma'>,</span> <span class='symbol'>:oldest_headline</span><span class='comma'>,</span> <span class='symbol'>:youngest_headline</span><span class='comma'>,</span> <span class='symbol'>:freshest_headline</span><span class='comma'>,</span> <span class='symbol'>:stalest_headline</span><span class='comma'>,</span> <span class='symbol'>:headlines_by_freshness</span><span class='comma'>,</span> <span class='symbol'>:headlines_by_staleness</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_active_leadline</span><span class='comma'>,</span> <span class='symbol'>:get_active_leadline_id</span><span class='comma'>,</span> <span class='symbol'>:active_leadline_age</span><span class='comma'>,</span> <span class='symbol'>:active_leadline_freshness</span><span class='comma'>,</span> <span class='symbol'>:set_active_leadline</span><span class='comma'>,</span> <span class='symbol'>:new_leadline</span><span class='comma'>,</span> <span class='symbol'>:leadlines_oldest_to_youngest</span><span class='comma'>,</span> <span class='symbol'>:leadlines_youngest_to_oldest</span><span class='comma'>,</span> <span class='symbol'>:oldest_leadline</span><span class='comma'>,</span> <span class='symbol'>:youngest_leadline</span><span class='comma'>,</span> <span class='symbol'>:freshest_leadline</span><span class='comma'>,</span> <span class='symbol'>:stalest_leadline</span><span class='comma'>,</span> <span class='symbol'>:leadlines_by_freshness</span><span class='comma'>,</span> <span class='symbol'>:leadlines_by_staleness</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:get_active_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_active_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:get_inactive_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_inactive_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:pop</span><span class='comma'>,</span> <span class='symbol'>:chop</span><span class='comma'>,</span> <span class='symbol'>:push</span><span class='comma'>,</span> <span class='symbol'>:append</span><span class='comma'>,</span> <span class='symbol'>:set_pstack_order</span><span class='comma'>,</span> <span class='symbol'>:is_pstack_consistent?</span><span class='comma'>,</span> <span class='symbol'>:make_pstack_consistent</span><span class='comma'>,</span> <span class='symbol'>:shift</span><span class='comma'>,</span> <span class='symbol'>:inactivate_pstack</span><span class='comma'>,</span> <span class='symbol'>:activate_pstack</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_citations</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:new_similar_story</span><span class='comma'>,</span> <span class='symbol'>:remove_similar_story</span><span class='comma'>,</span> <span class='symbol'>:get_similar_stories</span>
        
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="active_leadline_id=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="active_leadline_id-instance_method">
  
    - (<tt>Object</tt>) <strong>active_leadline_id</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>References the leadline used atop the story.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 96</span>

<span class='kw'>class</span> <span class='const'>Story</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'>ActionView</span><span class='op'>::</span><span class='const'>Helpers</span>
    
    <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbol'>:section</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:headlines</span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:leadlines</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:positions</span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:simple_contents</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:positions</span><span class='comma'>,</span> <span class='label'>source:</span> <span class='symbol'>:element</span><span class='comma'>,</span> <span class='label'>source_type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SimpleContent</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:quote_contents</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:positions</span><span class='comma'>,</span> <span class='label'>source:</span> <span class='symbol'>:element</span><span class='comma'>,</span> <span class='label'>source_type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>QuoteContent</span><span class='tstring_end'>&#39;</span></span>
    
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:simple_content_citations</span><span class='comma'>,</span> <span class='symbol'>:through</span> <span class='op'>=&gt;</span> <span class='symbol'>:simple_contents</span><span class='comma'>,</span> <span class='symbol'>:source</span> <span class='op'>=&gt;</span> <span class='symbol'>:citations</span> 
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:quote_content_citations</span><span class='comma'>,</span> <span class='symbol'>:through</span> <span class='op'>=&gt;</span> <span class='symbol'>:quote_contents</span><span class='comma'>,</span> <span class='symbol'>:source</span> <span class='op'>=&gt;</span> <span class='symbol'>:citations</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:relations</span>
    
    <span class='id identifier rubyid_validates'>validates</span> <span class='symbol'>:subject</span><span class='comma'>,</span> <span class='symbol'>:section_id</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_validates'>validates</span> <span class='symbol'>:subject</span><span class='comma'>,</span> <span class='label'>length:</span> <span class='lbrace'>{</span> <span class='label'>maximum:</span> <span class='int'>140</span> <span class='rbrace'>}</span>
    
    <span class='comment'>#@!group Age and Freshness methods
</span>    
    <span class='comment'># @!method get_date_created
</span>    <span class='comment'># @return [TimeWithZone] the timedate when the citation was created
</span>    <span class='comment'># @example 
</span>    <span class='comment'>#     kat.get_date_created =&gt; Mon, 09 Feb 2015 15:18:20 UTC +00:00
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_date_created'>get_date_created</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_date_updated
</span>    <span class='comment'># @return [TimeWithZone] the timedate when the citation was created
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    kat.get_date_updated =&gt; Mon, 09 Feb 2015 15:31:29 UTC +00:00
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_date_updated'>get_date_updated</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_updated_at'>updated_at</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method age
</span>    <span class='comment'># The age in words. Time from creation until now.
</span>    <span class='comment'># @return [String]
</span>    <span class='comment'># @example
</span>    <span class='comment'>#     cit.age =&gt; &quot;about 16 hours&quot;
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_age'>age</span>
        <span class='id identifier rubyid_time_ago_in_words'>time_ago_in_words</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_date_created'>get_date_created</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshness
</span>    <span class='comment'># The freshness in words. Time from last updated until now.
</span>    <span class='comment'># @return [String]
</span>    <span class='comment'># @example
</span>    <span class='comment'>#     hl.freshness =&gt; &quot;6 minutes&quot;
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshness'>freshness</span>
        <span class='id identifier rubyid_time_ago_in_words'>time_ago_in_words</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_date_updated'>get_date_updated</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Getters and Setters of descriptive attributes
</span>    
    <span class='comment'># @!method get_subject
</span>    <span class='comment'># Returns the subject of the story. A short description of the story, helping authors.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_subject'>get_subject</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method about
</span>    <span class='comment'># Alias for get_subject
</span>    <span class='comment'># @return [String]
</span>    <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:about</span><span class='comma'>,</span> <span class='symbol'>:get_subject</span>
    
    <span class='comment'># @!method set_subject(new_subject)
</span>    <span class='comment'># Sets the subject to a new subject and then saves.
</span>    <span class='comment'># @param [String] new_subject
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_subject'>set_subject</span> <span class='lparen'>(</span><span class='id identifier rubyid_new_subject'>new_subject</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_new_subject'>new_subject</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method filed_under?
</span>    <span class='comment'># What Section is this Story filed under?
</span>    <span class='comment'># @return [String] the section title of the owning Section
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_filed_under?'>filed_under?</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method set_section(section_id)
</span>    <span class='comment'># Sets the section_id of this story
</span>    <span class='comment'># @param [Integer] section_id
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_section'>set_section</span><span class='lparen'>(</span><span class='id identifier rubyid_section_id'>section_id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_section_id'>section_id</span> <span class='op'>=</span> <span class='id identifier rubyid_section_id'>section_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group headline methods
</span>    
    <span class='comment'># @!method get_active_headline
</span>    <span class='comment'># The active headline of the story.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_headline'>get_active_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_active_headline_id
</span>    <span class='comment'># The active headline id of the story.
</span>    <span class='comment'># @return [Integer] the id of the active headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_headline_id'>get_active_headline_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_headline_age
</span>    <span class='comment'># The age of the active headline. Time from creation until now.
</span>    <span class='comment'># @return [String] the age in words
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_headline_age'>active_headline_age</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_age'>age</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_headline_freshness
</span>    <span class='comment'># The freshness of the active headline. From last updated until now.
</span>    <span class='comment'># @return [String] the freshness in words 
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_headline_freshness'>active_headline_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freshness'>freshness</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method set_active_headline(id)
</span>    <span class='comment'># Set the active to a headline that already exists using its id. And saves it to the database.
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_active_headline'>set_active_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>   
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_headline(new_headline, make_active=true)
</span>    <span class='comment'># Create a new headline for this story. make_active true/false, true makes
</span>    <span class='comment'>#   this new headline the active one.
</span>    <span class='comment'># @return [Boolean] if save is successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_headline'>new_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_new_headline'>new_headline</span><span class='comma'>,</span> <span class='id identifier rubyid_make_active'>make_active</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_kat'>kat</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>content:</span> <span class='id identifier rubyid_new_headline'>new_headline</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_make_active'>make_active</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_active_headline'>set_active_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_kat'>kat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_oldest_to_youngest
</span>    <span class='comment'># Return all headlines in order from the oldest to the youngest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_oldest_to_youngest'>headlines_oldest_to_youngest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_youngest_to_oldest
</span>    <span class='comment'># Return all headlines from the youngest to oldest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_youngest_to_oldest'>headlines_youngest_to_oldest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>        
    <span class='kw'>end</span>

    <span class='comment'># @!method oldest_headline
</span>    <span class='comment'># Returns the first created headline.
</span>    <span class='comment'># @return [String] the oldest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_oldest_headline'>oldest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method youngest_headline
</span>    <span class='comment'># Returns the last created headline.
</span>    <span class='comment'># @return [String] the youngest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_youngest_headline'>youngest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshest_headline
</span>    <span class='comment'># Returns the most recently updated headline.
</span>    <span class='comment'># @return [String] the freshest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshest_headline'>freshest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method stalest_headline
</span>    <span class='comment'># Returns the oldest updated headline.
</span>    <span class='comment'># @return [String] the stalest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_stalest_headline'>stalest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_by_freshness
</span>    <span class='comment'># Returns all headlines from the freshest to the stalest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_by_freshness'>headlines_by_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>    
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_by_staleness
</span>    <span class='comment'># Returns all headlines from the stalest to the freshest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_by_staleness'>headlines_by_staleness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group leadline methods
</span>    
    <span class='comment'># @!method get_active_leadline
</span>    <span class='comment'># The active leadline of the story.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_leadline'>get_active_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_active_leadline_id
</span>    <span class='comment'># The active leadline id of the story.
</span>    <span class='comment'># @return [Integer] the id of the active leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_leadline_id'>get_active_leadline_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_leadline_age
</span>    <span class='comment'># The age of the active leadline. Time from creation until now.
</span>    <span class='comment'># @return [String] the age in words
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_leadline_age'>active_leadline_age</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_age'>age</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_leadline_freshness
</span>    <span class='comment'># The freshness of the active leadline. From last updated until now.
</span>    <span class='comment'># @return [String] the freshness in words 
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_leadline_freshness'>active_leadline_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freshness'>freshness</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method set_active_leadline(id)
</span>    <span class='comment'># Set the active to a leadline that already exists using its id. And saves it to the database.
</span>    <span class='comment'># @param [Integer] id
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_active_leadline'>set_active_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>   
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_leadline(new_leadline, make_active=true)
</span>    <span class='comment'># Create a new leadline for this story. make_active true/false, true makes
</span>    <span class='comment'>#   this new leadline the active one.
</span>    <span class='comment'># @return [Boolean] if save is successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='comma'>,</span> <span class='id identifier rubyid_make_active'>make_active</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_kat'>kat</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>content:</span> <span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_make_active'>make_active</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_active_leadline'>set_active_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_kat'>kat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_oldest_to_youngest
</span>    <span class='comment'># Return all leadlines in order from the oldest to the youngest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_oldest_to_youngest'>leadlines_oldest_to_youngest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_youngest_to_oldest
</span>    <span class='comment'># Return all leadlines from the youngest to oldest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_youngest_to_oldest'>leadlines_youngest_to_oldest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>        
    <span class='kw'>end</span>

    <span class='comment'># @!method oldest_leadline
</span>    <span class='comment'># Returns the first created leadline.
</span>    <span class='comment'># @return [String] the oldest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_oldest_leadline'>oldest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method youngest_leadline
</span>    <span class='comment'># Returns the last created leadline.
</span>    <span class='comment'># @return [String] the youngest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_youngest_leadline'>youngest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshest_leadline
</span>    <span class='comment'># Returns the most recently updated leadline.
</span>    <span class='comment'># @return [String] the freshest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshest_leadline'>freshest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method stalest_leadline
</span>    <span class='comment'># Returns the oldest updated leadline.
</span>    <span class='comment'># @return [String] the stalest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_stalest_leadline'>stalest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_by_freshness
</span>    <span class='comment'># Returns all leadlines from the freshest to the stalest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_by_freshness'>leadlines_by_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>    
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_by_staleness
</span>    <span class='comment'># Returns all leadlines from the stalest to the freshest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_by_staleness'>leadlines_by_staleness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Position Stack (pstack) manipulation        
</span>    
    <span class='comment'># @!method get_pstack_forwards
</span>    <span class='comment'># The whole pstack in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_pstack_forwards'>get_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_pstack_backwards
</span>    <span class='comment'># The whole pstack in descending order. 
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_pstack_backwards'>get_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_active_pstack_forwards
</span>    <span class='comment'># The pstack with only active positions, in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_pstack_forwards'>get_active_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_active_pstack_backwards
</span>    <span class='comment'># The pstack with only active positions, in descending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_pstack_backwards'>get_active_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_inactive_pstack_forwards
</span>    <span class='comment'># The pstack with only inactive positions, in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_inactive_pstack_forwards'>get_inactive_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_inactive_pstack_backwards
</span>    <span class='comment'># The pstack with only inactive positions, in descending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_inactive_pstack_backwards'>get_inactive_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method is_pstack_consistent?
</span>    <span class='comment'># Determines if the pstack is in compact order.
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    consistent: [1, 2, 3, 4, 5]
</span>    <span class='comment'>#    consistent: [15, 16, 17, 18, 19]
</span>    <span class='comment'>#    inconsistent: [3, 6, 9, 12, 34]
</span>    <span class='comment'>#    inconsistent: [3, 3, 3, 4, 5] (this shouldn&#39;t occur if validation is on)
</span>    <span class='comment'># @return [Boolean] answer to your question.        
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_is_pstack_consistent?'>is_pstack_consistent?</span>
        <span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        <span class='id identifier rubyid_len'>len</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        
        <span class='lparen'>(</span><span class='id identifier rubyid_last'>last</span> <span class='op'>-</span> <span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='id identifier rubyid_len'>len</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method make_pstack_consistent(start=1)
</span>    <span class='comment'># Makes the pstack consistent. This is really a helper utility, may never needs to be used,
</span>    <span class='comment'># and especially not outside the context of this object.
</span>    <span class='comment'># @param [Integer] start what number will the first position start at? default = 1
</span>    <span class='comment'># @return [Boolean] returns true on complete
</span>    <span class='comment'>#    returns false if the param was 0 or 1
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 5, 9, 23]
</span>    <span class='comment'>#    story.is_consistent? #=&gt; false
</span>    <span class='comment'>#    story.make_pstack_consistent #=&gt; true
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 3, 4, 5]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>&lt;=</span> <span class='int'>0</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
        
        <span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_is_pstack_consistent?'>is_pstack_consistent?</span>
            <span class='comment'># True it&#39;s in order, then do we need to shift it?
</span>            <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span> <span class='op'>==</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='comment'># nothing to do
</span>                <span class='kw'>return</span> <span class='kw'>true</span>
            <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span> <span class='op'>!=</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='comment'># TODO: shift it
</span>                <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>-</span> <span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
                <span class='kw'>return</span> <span class='kw'>true</span>
            <span class='kw'>end</span>
        <span class='kw'>else</span> <span class='comment'># not consistent
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='comment'># b/c each story.positions.position needs to be uniqe, we run into the issue of 
</span>                <span class='comment'># Validation failed: Position has already been taken
</span>                <span class='comment'># so, we&#39;ll set the order in negative numbers and just flip their signs
</span>                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
                <span class='id identifier rubyid_start'>start</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='kw'>end</span>
                <span class='comment'># now to switch back to positive positions
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> 
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method shift(modifier)
</span>    <span class='comment'># Shift all the positions in the pstack by the modifier. Irregardless of activeness
</span>    <span class='comment'># of the positions. modifier=1 would shift the pstack down 1, modifier=-1 would shift it up 1
</span>    <span class='comment'># @param [Integer] modifier the number to shift the positions
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 3, 4, 5]
</span>    <span class='comment'>#    story.shift(10)
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [11, 12, 13, 14, 15]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_modifier'>modifier</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_modifier'>modifier</span> <span class='op'>&gt;</span> <span class='int'>0</span> 
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_modifier'>modifier</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>            
        <span class='kw'>elsif</span> <span class='id identifier rubyid_modifier'>modifier</span> <span class='op'>&lt;</span> <span class='int'>0</span> 
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_modifier'>modifier</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>    
        <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method set_pstack_order(order)
</span>    <span class='comment'># Reorders the pstack in the order of an array of position ids. First id in the array becomes
</span>    <span class='comment'># the first position, the second id becomes the second, and so on.
</span>    <span class='comment'># @return [Nil] if there isn&#39;t the same number of elements in the array and pstack
</span>    <span class='comment'># @return [Nil] if the pstack position id&#39;s do not include exactly the id&#39;s in the array
</span>    <span class='comment'># @return [True] if successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_pstack_order'>set_pstack_order</span><span class='lparen'>(</span><span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span> 
            <span class='comment'>#determine if the supplied order ids are actually owned by the story
</span>            <span class='id identifier rubyid_pstack'>pstack</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span>
                <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_pstack'>pstack</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
                    <span class='kw'>return</span> <span class='kw'>false</span>
                <span class='kw'>end</span>
            <span class='kw'>end</span>
            <span class='comment'># set the pstack to the order
</span>            <span class='id identifier rubyid_position_order'>position_order</span> <span class='op'>=</span> <span class='int'>1</span>
            <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Position</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_position_order'>position_order</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
                <span class='id identifier rubyid_position_order'>position_order</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='kw'>end</span>
            <span class='comment'># now to switch back to positive positions
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reload'>reload</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> 
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method pop
</span>    <span class='comment'># Removes the last position on the pstack, or returns nil if the pstack is empty.
</span>    <span class='comment'># @return [Nil] empty pstack
</span>    <span class='comment'># @return [True] if operation was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_pop'>pop</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method chop
</span>    <span class='comment'># Removes the first position on the pstack, or returns nil if the pstack is empty.
</span>    <span class='comment'># @return [Nil] empty pstack
</span>    <span class='comment'># @return [True] if operation was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_chop'>chop</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method push (element)
</span>    <span class='comment'># Adds an position with and element to the beginning of the pstack. Shifts and makes consistent
</span>    <span class='comment'># the remaining of the pstack.
</span>    <span class='comment'># @param [SimpleContent, QuoteContent] element any element
</span>    <span class='comment'># @return [Boolean]    
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_element'>element</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
      
        <span class='comment'># @!method append(element)
</span>    <span class='comment'># Adds an position with and element to the end of the pstack. Makes consistent the pstack.
</span>    <span class='comment'># @param [SimpleContent, QuoteContent] element any element
</span>    <span class='comment'># @return [Boolean]             
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_append'>append</span> <span class='lparen'>(</span><span class='id identifier rubyid_element'>element</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_last_pos'>last_pos</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='id identifier rubyid_last_pos'>last_pos</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method inactivate_pstack
</span>    <span class='comment'># Inactivates all the positions of this story.
</span>    <span class='comment'># @return [True] no matter what, humph.
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_inactivate_pstack'>inactivate_pstack</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_inactivate'>inactivate</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method activate_pstack
</span>    <span class='comment'># Activates all the positions of this story.
</span>    <span class='comment'># @return [True] no matter what, humph.
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_activate_pstack'>activate_pstack</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_activate'>activate</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Content Aggregation
</span>        
    <span class='comment'># @!method get_similar_stories
</span>    <span class='comment'># Alias for self.relations
</span>    <span class='comment'># @return [ActiveCollection] a collection of all the stories tied to self
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_similar_stories'>get_similar_stories</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span>
    <span class='kw'>end</span>
                
    <span class='comment'># @!method get_citations
</span>    <span class='comment'># Returns and array of all the citations that are attached through positions.
</span>    <span class='comment'># @return [Array] all the citations associated through positions
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_citations'>get_citations</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_simple_content_citations'>simple_content_citations</span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_quote_content_citations'>quote_content_citations</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_similar_story(story_id_to_connect_to)
</span>            <span class='comment'># Creates a new tie between the parent story and a passed story id.
</span>    <span class='comment'># @param [Integer] story_id_to_connect_to is the story id to link to
</span>    <span class='comment'># @return [Boolean] true if save is successful, false if save is unsuccessful, if similar
</span>    <span class='comment'>#    story is already a similiar story, or if similiar story and self are the same
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_similar_story'>new_similar_story</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='rparen'>)</span>
        <span class='comment'># if the param is the same as self, or if param is aready connected to self
</span>        <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:tie_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>!=</span> <span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span> <span class='kw'>and</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='label'>tie_id:</span> <span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='comma'>,</span> <span class='label'>tie_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Story</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>else</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method remove_similar_story(story_id_to_remove)
</span>    <span class='comment'># Destroys the connection between self and the similar story
</span>    <span class='comment'># @param [Integer] story_id_to_remove the id of the tied story
</span>    <span class='comment'># @return [Boolean] true if the destroyed, false if not
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_remove_similar_story'>remove_similar_story</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:tie_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='const'>Relation</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>story_id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>tie_id:</span> <span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='comma'>,</span> <span class='label'>tie_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Story</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>else</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='comment'>#@!endgroup        
</span>       
<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:age</span><span class='comma'>,</span> <span class='symbol'>:freshness</span><span class='comma'>,</span> <span class='symbol'>:get_date_created</span><span class='comma'>,</span> <span class='symbol'>:get_date_updated</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:filed_under?</span><span class='comma'>,</span> <span class='symbol'>:get_subject</span><span class='comma'>,</span> <span class='symbol'>:about</span><span class='comma'>,</span> <span class='symbol'>:set_subject</span><span class='comma'>,</span> <span class='symbol'>:set_section</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_active_headline</span><span class='comma'>,</span> <span class='symbol'>:get_active_headline_id</span><span class='comma'>,</span> <span class='symbol'>:active_headline_age</span><span class='comma'>,</span> <span class='symbol'>:active_headline_freshness</span><span class='comma'>,</span> <span class='symbol'>:set_active_headline</span><span class='comma'>,</span> <span class='symbol'>:new_headline</span><span class='comma'>,</span> <span class='symbol'>:headlines_oldest_to_youngest</span><span class='comma'>,</span> <span class='symbol'>:headlines_youngest_to_oldest</span><span class='comma'>,</span> <span class='symbol'>:oldest_headline</span><span class='comma'>,</span> <span class='symbol'>:youngest_headline</span><span class='comma'>,</span> <span class='symbol'>:freshest_headline</span><span class='comma'>,</span> <span class='symbol'>:stalest_headline</span><span class='comma'>,</span> <span class='symbol'>:headlines_by_freshness</span><span class='comma'>,</span> <span class='symbol'>:headlines_by_staleness</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_active_leadline</span><span class='comma'>,</span> <span class='symbol'>:get_active_leadline_id</span><span class='comma'>,</span> <span class='symbol'>:active_leadline_age</span><span class='comma'>,</span> <span class='symbol'>:active_leadline_freshness</span><span class='comma'>,</span> <span class='symbol'>:set_active_leadline</span><span class='comma'>,</span> <span class='symbol'>:new_leadline</span><span class='comma'>,</span> <span class='symbol'>:leadlines_oldest_to_youngest</span><span class='comma'>,</span> <span class='symbol'>:leadlines_youngest_to_oldest</span><span class='comma'>,</span> <span class='symbol'>:oldest_leadline</span><span class='comma'>,</span> <span class='symbol'>:youngest_leadline</span><span class='comma'>,</span> <span class='symbol'>:freshest_leadline</span><span class='comma'>,</span> <span class='symbol'>:stalest_leadline</span><span class='comma'>,</span> <span class='symbol'>:leadlines_by_freshness</span><span class='comma'>,</span> <span class='symbol'>:leadlines_by_staleness</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:get_active_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_active_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:get_inactive_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_inactive_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:pop</span><span class='comma'>,</span> <span class='symbol'>:chop</span><span class='comma'>,</span> <span class='symbol'>:push</span><span class='comma'>,</span> <span class='symbol'>:append</span><span class='comma'>,</span> <span class='symbol'>:set_pstack_order</span><span class='comma'>,</span> <span class='symbol'>:is_pstack_consistent?</span><span class='comma'>,</span> <span class='symbol'>:make_pstack_consistent</span><span class='comma'>,</span> <span class='symbol'>:shift</span><span class='comma'>,</span> <span class='symbol'>:inactivate_pstack</span><span class='comma'>,</span> <span class='symbol'>:activate_pstack</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_citations</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:new_similar_story</span><span class='comma'>,</span> <span class='symbol'>:remove_similar_story</span><span class='comma'>,</span> <span class='symbol'>:get_similar_stories</span>
        
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="section_id=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="section_id-instance_method">
  
    - (<tt>Object</tt>) <strong>section_id</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Categorized under this section.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 96</span>

<span class='kw'>class</span> <span class='const'>Story</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'>ActionView</span><span class='op'>::</span><span class='const'>Helpers</span>
    
    <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbol'>:section</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:headlines</span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:leadlines</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:positions</span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:simple_contents</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:positions</span><span class='comma'>,</span> <span class='label'>source:</span> <span class='symbol'>:element</span><span class='comma'>,</span> <span class='label'>source_type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SimpleContent</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:quote_contents</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:positions</span><span class='comma'>,</span> <span class='label'>source:</span> <span class='symbol'>:element</span><span class='comma'>,</span> <span class='label'>source_type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>QuoteContent</span><span class='tstring_end'>&#39;</span></span>
    
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:simple_content_citations</span><span class='comma'>,</span> <span class='symbol'>:through</span> <span class='op'>=&gt;</span> <span class='symbol'>:simple_contents</span><span class='comma'>,</span> <span class='symbol'>:source</span> <span class='op'>=&gt;</span> <span class='symbol'>:citations</span> 
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:quote_content_citations</span><span class='comma'>,</span> <span class='symbol'>:through</span> <span class='op'>=&gt;</span> <span class='symbol'>:quote_contents</span><span class='comma'>,</span> <span class='symbol'>:source</span> <span class='op'>=&gt;</span> <span class='symbol'>:citations</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:relations</span>
    
    <span class='id identifier rubyid_validates'>validates</span> <span class='symbol'>:subject</span><span class='comma'>,</span> <span class='symbol'>:section_id</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_validates'>validates</span> <span class='symbol'>:subject</span><span class='comma'>,</span> <span class='label'>length:</span> <span class='lbrace'>{</span> <span class='label'>maximum:</span> <span class='int'>140</span> <span class='rbrace'>}</span>
    
    <span class='comment'>#@!group Age and Freshness methods
</span>    
    <span class='comment'># @!method get_date_created
</span>    <span class='comment'># @return [TimeWithZone] the timedate when the citation was created
</span>    <span class='comment'># @example 
</span>    <span class='comment'>#     kat.get_date_created =&gt; Mon, 09 Feb 2015 15:18:20 UTC +00:00
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_date_created'>get_date_created</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_date_updated
</span>    <span class='comment'># @return [TimeWithZone] the timedate when the citation was created
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    kat.get_date_updated =&gt; Mon, 09 Feb 2015 15:31:29 UTC +00:00
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_date_updated'>get_date_updated</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_updated_at'>updated_at</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method age
</span>    <span class='comment'># The age in words. Time from creation until now.
</span>    <span class='comment'># @return [String]
</span>    <span class='comment'># @example
</span>    <span class='comment'>#     cit.age =&gt; &quot;about 16 hours&quot;
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_age'>age</span>
        <span class='id identifier rubyid_time_ago_in_words'>time_ago_in_words</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_date_created'>get_date_created</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshness
</span>    <span class='comment'># The freshness in words. Time from last updated until now.
</span>    <span class='comment'># @return [String]
</span>    <span class='comment'># @example
</span>    <span class='comment'>#     hl.freshness =&gt; &quot;6 minutes&quot;
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshness'>freshness</span>
        <span class='id identifier rubyid_time_ago_in_words'>time_ago_in_words</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_date_updated'>get_date_updated</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Getters and Setters of descriptive attributes
</span>    
    <span class='comment'># @!method get_subject
</span>    <span class='comment'># Returns the subject of the story. A short description of the story, helping authors.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_subject'>get_subject</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method about
</span>    <span class='comment'># Alias for get_subject
</span>    <span class='comment'># @return [String]
</span>    <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:about</span><span class='comma'>,</span> <span class='symbol'>:get_subject</span>
    
    <span class='comment'># @!method set_subject(new_subject)
</span>    <span class='comment'># Sets the subject to a new subject and then saves.
</span>    <span class='comment'># @param [String] new_subject
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_subject'>set_subject</span> <span class='lparen'>(</span><span class='id identifier rubyid_new_subject'>new_subject</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_new_subject'>new_subject</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method filed_under?
</span>    <span class='comment'># What Section is this Story filed under?
</span>    <span class='comment'># @return [String] the section title of the owning Section
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_filed_under?'>filed_under?</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method set_section(section_id)
</span>    <span class='comment'># Sets the section_id of this story
</span>    <span class='comment'># @param [Integer] section_id
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_section'>set_section</span><span class='lparen'>(</span><span class='id identifier rubyid_section_id'>section_id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_section_id'>section_id</span> <span class='op'>=</span> <span class='id identifier rubyid_section_id'>section_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group headline methods
</span>    
    <span class='comment'># @!method get_active_headline
</span>    <span class='comment'># The active headline of the story.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_headline'>get_active_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_active_headline_id
</span>    <span class='comment'># The active headline id of the story.
</span>    <span class='comment'># @return [Integer] the id of the active headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_headline_id'>get_active_headline_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_headline_age
</span>    <span class='comment'># The age of the active headline. Time from creation until now.
</span>    <span class='comment'># @return [String] the age in words
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_headline_age'>active_headline_age</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_age'>age</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_headline_freshness
</span>    <span class='comment'># The freshness of the active headline. From last updated until now.
</span>    <span class='comment'># @return [String] the freshness in words 
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_headline_freshness'>active_headline_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freshness'>freshness</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method set_active_headline(id)
</span>    <span class='comment'># Set the active to a headline that already exists using its id. And saves it to the database.
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_active_headline'>set_active_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>   
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_headline(new_headline, make_active=true)
</span>    <span class='comment'># Create a new headline for this story. make_active true/false, true makes
</span>    <span class='comment'>#   this new headline the active one.
</span>    <span class='comment'># @return [Boolean] if save is successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_headline'>new_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_new_headline'>new_headline</span><span class='comma'>,</span> <span class='id identifier rubyid_make_active'>make_active</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_kat'>kat</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>content:</span> <span class='id identifier rubyid_new_headline'>new_headline</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_make_active'>make_active</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_active_headline'>set_active_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_kat'>kat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_oldest_to_youngest
</span>    <span class='comment'># Return all headlines in order from the oldest to the youngest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_oldest_to_youngest'>headlines_oldest_to_youngest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_youngest_to_oldest
</span>    <span class='comment'># Return all headlines from the youngest to oldest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_youngest_to_oldest'>headlines_youngest_to_oldest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>        
    <span class='kw'>end</span>

    <span class='comment'># @!method oldest_headline
</span>    <span class='comment'># Returns the first created headline.
</span>    <span class='comment'># @return [String] the oldest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_oldest_headline'>oldest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method youngest_headline
</span>    <span class='comment'># Returns the last created headline.
</span>    <span class='comment'># @return [String] the youngest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_youngest_headline'>youngest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshest_headline
</span>    <span class='comment'># Returns the most recently updated headline.
</span>    <span class='comment'># @return [String] the freshest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshest_headline'>freshest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method stalest_headline
</span>    <span class='comment'># Returns the oldest updated headline.
</span>    <span class='comment'># @return [String] the stalest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_stalest_headline'>stalest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_by_freshness
</span>    <span class='comment'># Returns all headlines from the freshest to the stalest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_by_freshness'>headlines_by_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>    
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_by_staleness
</span>    <span class='comment'># Returns all headlines from the stalest to the freshest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_by_staleness'>headlines_by_staleness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group leadline methods
</span>    
    <span class='comment'># @!method get_active_leadline
</span>    <span class='comment'># The active leadline of the story.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_leadline'>get_active_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_active_leadline_id
</span>    <span class='comment'># The active leadline id of the story.
</span>    <span class='comment'># @return [Integer] the id of the active leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_leadline_id'>get_active_leadline_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_leadline_age
</span>    <span class='comment'># The age of the active leadline. Time from creation until now.
</span>    <span class='comment'># @return [String] the age in words
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_leadline_age'>active_leadline_age</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_age'>age</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_leadline_freshness
</span>    <span class='comment'># The freshness of the active leadline. From last updated until now.
</span>    <span class='comment'># @return [String] the freshness in words 
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_leadline_freshness'>active_leadline_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freshness'>freshness</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method set_active_leadline(id)
</span>    <span class='comment'># Set the active to a leadline that already exists using its id. And saves it to the database.
</span>    <span class='comment'># @param [Integer] id
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_active_leadline'>set_active_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>   
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_leadline(new_leadline, make_active=true)
</span>    <span class='comment'># Create a new leadline for this story. make_active true/false, true makes
</span>    <span class='comment'>#   this new leadline the active one.
</span>    <span class='comment'># @return [Boolean] if save is successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='comma'>,</span> <span class='id identifier rubyid_make_active'>make_active</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_kat'>kat</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>content:</span> <span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_make_active'>make_active</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_active_leadline'>set_active_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_kat'>kat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_oldest_to_youngest
</span>    <span class='comment'># Return all leadlines in order from the oldest to the youngest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_oldest_to_youngest'>leadlines_oldest_to_youngest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_youngest_to_oldest
</span>    <span class='comment'># Return all leadlines from the youngest to oldest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_youngest_to_oldest'>leadlines_youngest_to_oldest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>        
    <span class='kw'>end</span>

    <span class='comment'># @!method oldest_leadline
</span>    <span class='comment'># Returns the first created leadline.
</span>    <span class='comment'># @return [String] the oldest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_oldest_leadline'>oldest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method youngest_leadline
</span>    <span class='comment'># Returns the last created leadline.
</span>    <span class='comment'># @return [String] the youngest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_youngest_leadline'>youngest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshest_leadline
</span>    <span class='comment'># Returns the most recently updated leadline.
</span>    <span class='comment'># @return [String] the freshest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshest_leadline'>freshest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method stalest_leadline
</span>    <span class='comment'># Returns the oldest updated leadline.
</span>    <span class='comment'># @return [String] the stalest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_stalest_leadline'>stalest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_by_freshness
</span>    <span class='comment'># Returns all leadlines from the freshest to the stalest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_by_freshness'>leadlines_by_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>    
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_by_staleness
</span>    <span class='comment'># Returns all leadlines from the stalest to the freshest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_by_staleness'>leadlines_by_staleness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Position Stack (pstack) manipulation        
</span>    
    <span class='comment'># @!method get_pstack_forwards
</span>    <span class='comment'># The whole pstack in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_pstack_forwards'>get_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_pstack_backwards
</span>    <span class='comment'># The whole pstack in descending order. 
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_pstack_backwards'>get_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_active_pstack_forwards
</span>    <span class='comment'># The pstack with only active positions, in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_pstack_forwards'>get_active_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_active_pstack_backwards
</span>    <span class='comment'># The pstack with only active positions, in descending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_pstack_backwards'>get_active_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_inactive_pstack_forwards
</span>    <span class='comment'># The pstack with only inactive positions, in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_inactive_pstack_forwards'>get_inactive_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_inactive_pstack_backwards
</span>    <span class='comment'># The pstack with only inactive positions, in descending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_inactive_pstack_backwards'>get_inactive_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method is_pstack_consistent?
</span>    <span class='comment'># Determines if the pstack is in compact order.
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    consistent: [1, 2, 3, 4, 5]
</span>    <span class='comment'>#    consistent: [15, 16, 17, 18, 19]
</span>    <span class='comment'>#    inconsistent: [3, 6, 9, 12, 34]
</span>    <span class='comment'>#    inconsistent: [3, 3, 3, 4, 5] (this shouldn&#39;t occur if validation is on)
</span>    <span class='comment'># @return [Boolean] answer to your question.        
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_is_pstack_consistent?'>is_pstack_consistent?</span>
        <span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        <span class='id identifier rubyid_len'>len</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        
        <span class='lparen'>(</span><span class='id identifier rubyid_last'>last</span> <span class='op'>-</span> <span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='id identifier rubyid_len'>len</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method make_pstack_consistent(start=1)
</span>    <span class='comment'># Makes the pstack consistent. This is really a helper utility, may never needs to be used,
</span>    <span class='comment'># and especially not outside the context of this object.
</span>    <span class='comment'># @param [Integer] start what number will the first position start at? default = 1
</span>    <span class='comment'># @return [Boolean] returns true on complete
</span>    <span class='comment'>#    returns false if the param was 0 or 1
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 5, 9, 23]
</span>    <span class='comment'>#    story.is_consistent? #=&gt; false
</span>    <span class='comment'>#    story.make_pstack_consistent #=&gt; true
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 3, 4, 5]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>&lt;=</span> <span class='int'>0</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
        
        <span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_is_pstack_consistent?'>is_pstack_consistent?</span>
            <span class='comment'># True it&#39;s in order, then do we need to shift it?
</span>            <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span> <span class='op'>==</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='comment'># nothing to do
</span>                <span class='kw'>return</span> <span class='kw'>true</span>
            <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span> <span class='op'>!=</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='comment'># TODO: shift it
</span>                <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>-</span> <span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
                <span class='kw'>return</span> <span class='kw'>true</span>
            <span class='kw'>end</span>
        <span class='kw'>else</span> <span class='comment'># not consistent
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='comment'># b/c each story.positions.position needs to be uniqe, we run into the issue of 
</span>                <span class='comment'># Validation failed: Position has already been taken
</span>                <span class='comment'># so, we&#39;ll set the order in negative numbers and just flip their signs
</span>                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
                <span class='id identifier rubyid_start'>start</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='kw'>end</span>
                <span class='comment'># now to switch back to positive positions
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> 
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method shift(modifier)
</span>    <span class='comment'># Shift all the positions in the pstack by the modifier. Irregardless of activeness
</span>    <span class='comment'># of the positions. modifier=1 would shift the pstack down 1, modifier=-1 would shift it up 1
</span>    <span class='comment'># @param [Integer] modifier the number to shift the positions
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 3, 4, 5]
</span>    <span class='comment'>#    story.shift(10)
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [11, 12, 13, 14, 15]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_modifier'>modifier</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_modifier'>modifier</span> <span class='op'>&gt;</span> <span class='int'>0</span> 
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_modifier'>modifier</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>            
        <span class='kw'>elsif</span> <span class='id identifier rubyid_modifier'>modifier</span> <span class='op'>&lt;</span> <span class='int'>0</span> 
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_modifier'>modifier</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>    
        <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method set_pstack_order(order)
</span>    <span class='comment'># Reorders the pstack in the order of an array of position ids. First id in the array becomes
</span>    <span class='comment'># the first position, the second id becomes the second, and so on.
</span>    <span class='comment'># @return [Nil] if there isn&#39;t the same number of elements in the array and pstack
</span>    <span class='comment'># @return [Nil] if the pstack position id&#39;s do not include exactly the id&#39;s in the array
</span>    <span class='comment'># @return [True] if successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_pstack_order'>set_pstack_order</span><span class='lparen'>(</span><span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span> 
            <span class='comment'>#determine if the supplied order ids are actually owned by the story
</span>            <span class='id identifier rubyid_pstack'>pstack</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span>
                <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_pstack'>pstack</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
                    <span class='kw'>return</span> <span class='kw'>false</span>
                <span class='kw'>end</span>
            <span class='kw'>end</span>
            <span class='comment'># set the pstack to the order
</span>            <span class='id identifier rubyid_position_order'>position_order</span> <span class='op'>=</span> <span class='int'>1</span>
            <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Position</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_position_order'>position_order</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
                <span class='id identifier rubyid_position_order'>position_order</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='kw'>end</span>
            <span class='comment'># now to switch back to positive positions
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reload'>reload</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> 
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method pop
</span>    <span class='comment'># Removes the last position on the pstack, or returns nil if the pstack is empty.
</span>    <span class='comment'># @return [Nil] empty pstack
</span>    <span class='comment'># @return [True] if operation was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_pop'>pop</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method chop
</span>    <span class='comment'># Removes the first position on the pstack, or returns nil if the pstack is empty.
</span>    <span class='comment'># @return [Nil] empty pstack
</span>    <span class='comment'># @return [True] if operation was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_chop'>chop</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method push (element)
</span>    <span class='comment'># Adds an position with and element to the beginning of the pstack. Shifts and makes consistent
</span>    <span class='comment'># the remaining of the pstack.
</span>    <span class='comment'># @param [SimpleContent, QuoteContent] element any element
</span>    <span class='comment'># @return [Boolean]    
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_element'>element</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
      
        <span class='comment'># @!method append(element)
</span>    <span class='comment'># Adds an position with and element to the end of the pstack. Makes consistent the pstack.
</span>    <span class='comment'># @param [SimpleContent, QuoteContent] element any element
</span>    <span class='comment'># @return [Boolean]             
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_append'>append</span> <span class='lparen'>(</span><span class='id identifier rubyid_element'>element</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_last_pos'>last_pos</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='id identifier rubyid_last_pos'>last_pos</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method inactivate_pstack
</span>    <span class='comment'># Inactivates all the positions of this story.
</span>    <span class='comment'># @return [True] no matter what, humph.
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_inactivate_pstack'>inactivate_pstack</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_inactivate'>inactivate</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method activate_pstack
</span>    <span class='comment'># Activates all the positions of this story.
</span>    <span class='comment'># @return [True] no matter what, humph.
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_activate_pstack'>activate_pstack</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_activate'>activate</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Content Aggregation
</span>        
    <span class='comment'># @!method get_similar_stories
</span>    <span class='comment'># Alias for self.relations
</span>    <span class='comment'># @return [ActiveCollection] a collection of all the stories tied to self
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_similar_stories'>get_similar_stories</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span>
    <span class='kw'>end</span>
                
    <span class='comment'># @!method get_citations
</span>    <span class='comment'># Returns and array of all the citations that are attached through positions.
</span>    <span class='comment'># @return [Array] all the citations associated through positions
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_citations'>get_citations</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_simple_content_citations'>simple_content_citations</span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_quote_content_citations'>quote_content_citations</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_similar_story(story_id_to_connect_to)
</span>            <span class='comment'># Creates a new tie between the parent story and a passed story id.
</span>    <span class='comment'># @param [Integer] story_id_to_connect_to is the story id to link to
</span>    <span class='comment'># @return [Boolean] true if save is successful, false if save is unsuccessful, if similar
</span>    <span class='comment'>#    story is already a similiar story, or if similiar story and self are the same
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_similar_story'>new_similar_story</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='rparen'>)</span>
        <span class='comment'># if the param is the same as self, or if param is aready connected to self
</span>        <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:tie_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>!=</span> <span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span> <span class='kw'>and</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='label'>tie_id:</span> <span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='comma'>,</span> <span class='label'>tie_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Story</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>else</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method remove_similar_story(story_id_to_remove)
</span>    <span class='comment'># Destroys the connection between self and the similar story
</span>    <span class='comment'># @param [Integer] story_id_to_remove the id of the tied story
</span>    <span class='comment'># @return [Boolean] true if the destroyed, false if not
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_remove_similar_story'>remove_similar_story</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:tie_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='const'>Relation</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>story_id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>tie_id:</span> <span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='comma'>,</span> <span class='label'>tie_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Story</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>else</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='comment'>#@!endgroup        
</span>       
<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:age</span><span class='comma'>,</span> <span class='symbol'>:freshness</span><span class='comma'>,</span> <span class='symbol'>:get_date_created</span><span class='comma'>,</span> <span class='symbol'>:get_date_updated</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:filed_under?</span><span class='comma'>,</span> <span class='symbol'>:get_subject</span><span class='comma'>,</span> <span class='symbol'>:about</span><span class='comma'>,</span> <span class='symbol'>:set_subject</span><span class='comma'>,</span> <span class='symbol'>:set_section</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_active_headline</span><span class='comma'>,</span> <span class='symbol'>:get_active_headline_id</span><span class='comma'>,</span> <span class='symbol'>:active_headline_age</span><span class='comma'>,</span> <span class='symbol'>:active_headline_freshness</span><span class='comma'>,</span> <span class='symbol'>:set_active_headline</span><span class='comma'>,</span> <span class='symbol'>:new_headline</span><span class='comma'>,</span> <span class='symbol'>:headlines_oldest_to_youngest</span><span class='comma'>,</span> <span class='symbol'>:headlines_youngest_to_oldest</span><span class='comma'>,</span> <span class='symbol'>:oldest_headline</span><span class='comma'>,</span> <span class='symbol'>:youngest_headline</span><span class='comma'>,</span> <span class='symbol'>:freshest_headline</span><span class='comma'>,</span> <span class='symbol'>:stalest_headline</span><span class='comma'>,</span> <span class='symbol'>:headlines_by_freshness</span><span class='comma'>,</span> <span class='symbol'>:headlines_by_staleness</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_active_leadline</span><span class='comma'>,</span> <span class='symbol'>:get_active_leadline_id</span><span class='comma'>,</span> <span class='symbol'>:active_leadline_age</span><span class='comma'>,</span> <span class='symbol'>:active_leadline_freshness</span><span class='comma'>,</span> <span class='symbol'>:set_active_leadline</span><span class='comma'>,</span> <span class='symbol'>:new_leadline</span><span class='comma'>,</span> <span class='symbol'>:leadlines_oldest_to_youngest</span><span class='comma'>,</span> <span class='symbol'>:leadlines_youngest_to_oldest</span><span class='comma'>,</span> <span class='symbol'>:oldest_leadline</span><span class='comma'>,</span> <span class='symbol'>:youngest_leadline</span><span class='comma'>,</span> <span class='symbol'>:freshest_leadline</span><span class='comma'>,</span> <span class='symbol'>:stalest_leadline</span><span class='comma'>,</span> <span class='symbol'>:leadlines_by_freshness</span><span class='comma'>,</span> <span class='symbol'>:leadlines_by_staleness</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:get_active_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_active_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:get_inactive_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_inactive_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:pop</span><span class='comma'>,</span> <span class='symbol'>:chop</span><span class='comma'>,</span> <span class='symbol'>:push</span><span class='comma'>,</span> <span class='symbol'>:append</span><span class='comma'>,</span> <span class='symbol'>:set_pstack_order</span><span class='comma'>,</span> <span class='symbol'>:is_pstack_consistent?</span><span class='comma'>,</span> <span class='symbol'>:make_pstack_consistent</span><span class='comma'>,</span> <span class='symbol'>:shift</span><span class='comma'>,</span> <span class='symbol'>:inactivate_pstack</span><span class='comma'>,</span> <span class='symbol'>:activate_pstack</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_citations</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:new_similar_story</span><span class='comma'>,</span> <span class='symbol'>:remove_similar_story</span><span class='comma'>,</span> <span class='symbol'>:get_similar_stories</span>
        
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="subject=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="subject-instance_method">
  
    - (<tt>Object</tt>) <strong>subject</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shorty describes this story. Used for the authors of stories to gist the
idea.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 96</span>

<span class='kw'>class</span> <span class='const'>Story</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'>ActionView</span><span class='op'>::</span><span class='const'>Helpers</span>
    
    <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbol'>:section</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:headlines</span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:leadlines</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:positions</span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:simple_contents</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:positions</span><span class='comma'>,</span> <span class='label'>source:</span> <span class='symbol'>:element</span><span class='comma'>,</span> <span class='label'>source_type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SimpleContent</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:quote_contents</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:positions</span><span class='comma'>,</span> <span class='label'>source:</span> <span class='symbol'>:element</span><span class='comma'>,</span> <span class='label'>source_type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>QuoteContent</span><span class='tstring_end'>&#39;</span></span>
    
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:simple_content_citations</span><span class='comma'>,</span> <span class='symbol'>:through</span> <span class='op'>=&gt;</span> <span class='symbol'>:simple_contents</span><span class='comma'>,</span> <span class='symbol'>:source</span> <span class='op'>=&gt;</span> <span class='symbol'>:citations</span> 
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:quote_content_citations</span><span class='comma'>,</span> <span class='symbol'>:through</span> <span class='op'>=&gt;</span> <span class='symbol'>:quote_contents</span><span class='comma'>,</span> <span class='symbol'>:source</span> <span class='op'>=&gt;</span> <span class='symbol'>:citations</span>

    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:relations</span>
    
    <span class='id identifier rubyid_validates'>validates</span> <span class='symbol'>:subject</span><span class='comma'>,</span> <span class='symbol'>:section_id</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_validates'>validates</span> <span class='symbol'>:subject</span><span class='comma'>,</span> <span class='label'>length:</span> <span class='lbrace'>{</span> <span class='label'>maximum:</span> <span class='int'>140</span> <span class='rbrace'>}</span>
    
    <span class='comment'>#@!group Age and Freshness methods
</span>    
    <span class='comment'># @!method get_date_created
</span>    <span class='comment'># @return [TimeWithZone] the timedate when the citation was created
</span>    <span class='comment'># @example 
</span>    <span class='comment'>#     kat.get_date_created =&gt; Mon, 09 Feb 2015 15:18:20 UTC +00:00
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_date_created'>get_date_created</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_date_updated
</span>    <span class='comment'># @return [TimeWithZone] the timedate when the citation was created
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    kat.get_date_updated =&gt; Mon, 09 Feb 2015 15:31:29 UTC +00:00
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_date_updated'>get_date_updated</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_updated_at'>updated_at</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method age
</span>    <span class='comment'># The age in words. Time from creation until now.
</span>    <span class='comment'># @return [String]
</span>    <span class='comment'># @example
</span>    <span class='comment'>#     cit.age =&gt; &quot;about 16 hours&quot;
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_age'>age</span>
        <span class='id identifier rubyid_time_ago_in_words'>time_ago_in_words</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_date_created'>get_date_created</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshness
</span>    <span class='comment'># The freshness in words. Time from last updated until now.
</span>    <span class='comment'># @return [String]
</span>    <span class='comment'># @example
</span>    <span class='comment'>#     hl.freshness =&gt; &quot;6 minutes&quot;
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshness'>freshness</span>
        <span class='id identifier rubyid_time_ago_in_words'>time_ago_in_words</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_date_updated'>get_date_updated</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Getters and Setters of descriptive attributes
</span>    
    <span class='comment'># @!method get_subject
</span>    <span class='comment'># Returns the subject of the story. A short description of the story, helping authors.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_subject'>get_subject</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method about
</span>    <span class='comment'># Alias for get_subject
</span>    <span class='comment'># @return [String]
</span>    <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:about</span><span class='comma'>,</span> <span class='symbol'>:get_subject</span>
    
    <span class='comment'># @!method set_subject(new_subject)
</span>    <span class='comment'># Sets the subject to a new subject and then saves.
</span>    <span class='comment'># @param [String] new_subject
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_subject'>set_subject</span> <span class='lparen'>(</span><span class='id identifier rubyid_new_subject'>new_subject</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_new_subject'>new_subject</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method filed_under?
</span>    <span class='comment'># What Section is this Story filed under?
</span>    <span class='comment'># @return [String] the section title of the owning Section
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_filed_under?'>filed_under?</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method set_section(section_id)
</span>    <span class='comment'># Sets the section_id of this story
</span>    <span class='comment'># @param [Integer] section_id
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_section'>set_section</span><span class='lparen'>(</span><span class='id identifier rubyid_section_id'>section_id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_section_id'>section_id</span> <span class='op'>=</span> <span class='id identifier rubyid_section_id'>section_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group headline methods
</span>    
    <span class='comment'># @!method get_active_headline
</span>    <span class='comment'># The active headline of the story.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_headline'>get_active_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_active_headline_id
</span>    <span class='comment'># The active headline id of the story.
</span>    <span class='comment'># @return [Integer] the id of the active headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_headline_id'>get_active_headline_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_headline_age
</span>    <span class='comment'># The age of the active headline. Time from creation until now.
</span>    <span class='comment'># @return [String] the age in words
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_headline_age'>active_headline_age</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_age'>age</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_headline_freshness
</span>    <span class='comment'># The freshness of the active headline. From last updated until now.
</span>    <span class='comment'># @return [String] the freshness in words 
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_headline_freshness'>active_headline_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freshness'>freshness</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method set_active_headline(id)
</span>    <span class='comment'># Set the active to a headline that already exists using its id. And saves it to the database.
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_active_headline'>set_active_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>   
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_headline(new_headline, make_active=true)
</span>    <span class='comment'># Create a new headline for this story. make_active true/false, true makes
</span>    <span class='comment'>#   this new headline the active one.
</span>    <span class='comment'># @return [Boolean] if save is successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_headline'>new_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_new_headline'>new_headline</span><span class='comma'>,</span> <span class='id identifier rubyid_make_active'>make_active</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_kat'>kat</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>content:</span> <span class='id identifier rubyid_new_headline'>new_headline</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_make_active'>make_active</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_active_headline'>set_active_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_kat'>kat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_oldest_to_youngest
</span>    <span class='comment'># Return all headlines in order from the oldest to the youngest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_oldest_to_youngest'>headlines_oldest_to_youngest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_youngest_to_oldest
</span>    <span class='comment'># Return all headlines from the youngest to oldest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_youngest_to_oldest'>headlines_youngest_to_oldest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>        
    <span class='kw'>end</span>

    <span class='comment'># @!method oldest_headline
</span>    <span class='comment'># Returns the first created headline.
</span>    <span class='comment'># @return [String] the oldest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_oldest_headline'>oldest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method youngest_headline
</span>    <span class='comment'># Returns the last created headline.
</span>    <span class='comment'># @return [String] the youngest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_youngest_headline'>youngest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshest_headline
</span>    <span class='comment'># Returns the most recently updated headline.
</span>    <span class='comment'># @return [String] the freshest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshest_headline'>freshest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method stalest_headline
</span>    <span class='comment'># Returns the oldest updated headline.
</span>    <span class='comment'># @return [String] the stalest headline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_stalest_headline'>stalest_headline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_by_freshness
</span>    <span class='comment'># Returns all headlines from the freshest to the stalest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_by_freshness'>headlines_by_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>    
    <span class='kw'>end</span>

    <span class='comment'># @!method headlines_by_staleness
</span>    <span class='comment'># Returns all headlines from the stalest to the freshest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_headlines_by_staleness'>headlines_by_staleness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group leadline methods
</span>    
    <span class='comment'># @!method get_active_leadline
</span>    <span class='comment'># The active leadline of the story.
</span>    <span class='comment'># @return [String]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_leadline'>get_active_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_active_leadline_id
</span>    <span class='comment'># The active leadline id of the story.
</span>    <span class='comment'># @return [Integer] the id of the active leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_leadline_id'>get_active_leadline_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_leadline_age
</span>    <span class='comment'># The age of the active leadline. Time from creation until now.
</span>    <span class='comment'># @return [String] the age in words
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_leadline_age'>active_leadline_age</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_age'>age</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method active_leadline_freshness
</span>    <span class='comment'># The freshness of the active leadline. From last updated until now.
</span>    <span class='comment'># @return [String] the freshness in words 
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_active_leadline_freshness'>active_leadline_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freshness'>freshness</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method set_active_leadline(id)
</span>    <span class='comment'># Set the active to a leadline that already exists using its id. And saves it to the database.
</span>    <span class='comment'># @param [Integer] id
</span>    <span class='comment'># @return [Boolean] if the save was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_active_leadline'>set_active_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>   
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_leadline(new_leadline, make_active=true)
</span>    <span class='comment'># Create a new leadline for this story. make_active true/false, true makes
</span>    <span class='comment'>#   this new leadline the active one.
</span>    <span class='comment'># @return [Boolean] if save is successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='comma'>,</span> <span class='id identifier rubyid_make_active'>make_active</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_kat'>kat</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>content:</span> <span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_make_active'>make_active</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_active_leadline'>set_active_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_kat'>kat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_oldest_to_youngest
</span>    <span class='comment'># Return all leadlines in order from the oldest to the youngest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_oldest_to_youngest'>leadlines_oldest_to_youngest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_youngest_to_oldest
</span>    <span class='comment'># Return all leadlines from the youngest to oldest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_youngest_to_oldest'>leadlines_youngest_to_oldest</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>        
    <span class='kw'>end</span>

    <span class='comment'># @!method oldest_leadline
</span>    <span class='comment'># Returns the first created leadline.
</span>    <span class='comment'># @return [String] the oldest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_oldest_leadline'>oldest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method youngest_leadline
</span>    <span class='comment'># Returns the last created leadline.
</span>    <span class='comment'># @return [String] the youngest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_youngest_leadline'>youngest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method freshest_leadline
</span>    <span class='comment'># Returns the most recently updated leadline.
</span>    <span class='comment'># @return [String] the freshest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_freshest_leadline'>freshest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method stalest_leadline
</span>    <span class='comment'># Returns the oldest updated leadline.
</span>    <span class='comment'># @return [String] the stalest leadline
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_stalest_leadline'>stalest_leadline</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_by_freshness
</span>    <span class='comment'># Returns all leadlines from the freshest to the stalest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_by_freshness'>leadlines_by_freshness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>    
    <span class='kw'>end</span>

    <span class='comment'># @!method leadlines_by_staleness
</span>    <span class='comment'># Returns all leadlines from the stalest to the freshest
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_leadlines_by_staleness'>leadlines_by_staleness</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Position Stack (pstack) manipulation        
</span>    
    <span class='comment'># @!method get_pstack_forwards
</span>    <span class='comment'># The whole pstack in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_pstack_forwards'>get_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method get_pstack_backwards
</span>    <span class='comment'># The whole pstack in descending order. 
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_pstack_backwards'>get_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_active_pstack_forwards
</span>    <span class='comment'># The pstack with only active positions, in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_pstack_forwards'>get_active_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_active_pstack_backwards
</span>    <span class='comment'># The pstack with only active positions, in descending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_active_pstack_backwards'>get_active_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_inactive_pstack_forwards
</span>    <span class='comment'># The pstack with only inactive positions, in ascending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_inactive_pstack_forwards'>get_inactive_pstack_forwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method get_inactive_pstack_backwards
</span>    <span class='comment'># The pstack with only inactive positions, in descending order.
</span>    <span class='comment'># @return [ActiveCollection]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_inactive_pstack_backwards'>get_inactive_pstack_backwards</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method is_pstack_consistent?
</span>    <span class='comment'># Determines if the pstack is in compact order.
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    consistent: [1, 2, 3, 4, 5]
</span>    <span class='comment'>#    consistent: [15, 16, 17, 18, 19]
</span>    <span class='comment'>#    inconsistent: [3, 6, 9, 12, 34]
</span>    <span class='comment'>#    inconsistent: [3, 3, 3, 4, 5] (this shouldn&#39;t occur if validation is on)
</span>    <span class='comment'># @return [Boolean] answer to your question.        
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_is_pstack_consistent?'>is_pstack_consistent?</span>
        <span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        <span class='id identifier rubyid_len'>len</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        
        <span class='lparen'>(</span><span class='id identifier rubyid_last'>last</span> <span class='op'>-</span> <span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='id identifier rubyid_len'>len</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method make_pstack_consistent(start=1)
</span>    <span class='comment'># Makes the pstack consistent. This is really a helper utility, may never needs to be used,
</span>    <span class='comment'># and especially not outside the context of this object.
</span>    <span class='comment'># @param [Integer] start what number will the first position start at? default = 1
</span>    <span class='comment'># @return [Boolean] returns true on complete
</span>    <span class='comment'>#    returns false if the param was 0 or 1
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 5, 9, 23]
</span>    <span class='comment'>#    story.is_consistent? #=&gt; false
</span>    <span class='comment'>#    story.make_pstack_consistent #=&gt; true
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 3, 4, 5]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>&lt;=</span> <span class='int'>0</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
        
        <span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
        
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_is_pstack_consistent?'>is_pstack_consistent?</span>
            <span class='comment'># True it&#39;s in order, then do we need to shift it?
</span>            <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span> <span class='op'>==</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='comment'># nothing to do
</span>                <span class='kw'>return</span> <span class='kw'>true</span>
            <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span> <span class='op'>!=</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='comment'># TODO: shift it
</span>                <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>-</span> <span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
                <span class='kw'>return</span> <span class='kw'>true</span>
            <span class='kw'>end</span>
        <span class='kw'>else</span> <span class='comment'># not consistent
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='comment'># b/c each story.positions.position needs to be uniqe, we run into the issue of 
</span>                <span class='comment'># Validation failed: Position has already been taken
</span>                <span class='comment'># so, we&#39;ll set the order in negative numbers and just flip their signs
</span>                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
                <span class='id identifier rubyid_start'>start</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='kw'>end</span>
                <span class='comment'># now to switch back to positive positions
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> 
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method shift(modifier)
</span>    <span class='comment'># Shift all the positions in the pstack by the modifier. Irregardless of activeness
</span>    <span class='comment'># of the positions. modifier=1 would shift the pstack down 1, modifier=-1 would shift it up 1
</span>    <span class='comment'># @param [Integer] modifier the number to shift the positions
</span>    <span class='comment'># @example
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [1, 2, 3, 4, 5]
</span>    <span class='comment'>#    story.shift(10)
</span>    <span class='comment'>#    story.get_pstack_forwards #=&gt; [11, 12, 13, 14, 15]
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_modifier'>modifier</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_modifier'>modifier</span> <span class='op'>&gt;</span> <span class='int'>0</span> 
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_modifier'>modifier</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>            
        <span class='kw'>elsif</span> <span class='id identifier rubyid_modifier'>modifier</span> <span class='op'>&lt;</span> <span class='int'>0</span> 
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_modifier'>modifier</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>    
        <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method set_pstack_order(order)
</span>    <span class='comment'># Reorders the pstack in the order of an array of position ids. First id in the array becomes
</span>    <span class='comment'># the first position, the second id becomes the second, and so on.
</span>    <span class='comment'># @return [Nil] if there isn&#39;t the same number of elements in the array and pstack
</span>    <span class='comment'># @return [Nil] if the pstack position id&#39;s do not include exactly the id&#39;s in the array
</span>    <span class='comment'># @return [True] if successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_set_pstack_order'>set_pstack_order</span><span class='lparen'>(</span><span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span> 
            <span class='comment'>#determine if the supplied order ids are actually owned by the story
</span>            <span class='id identifier rubyid_pstack'>pstack</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span>
                <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_pstack'>pstack</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
                    <span class='kw'>return</span> <span class='kw'>false</span>
                <span class='kw'>end</span>
            <span class='kw'>end</span>
            <span class='comment'># set the pstack to the order
</span>            <span class='id identifier rubyid_position_order'>position_order</span> <span class='op'>=</span> <span class='int'>1</span>
            <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Position</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_position_order'>position_order</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
                <span class='id identifier rubyid_position_order'>position_order</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='kw'>end</span>
            <span class='comment'># now to switch back to positive positions
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reload'>reload</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> 
                <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='comment'># @!method pop
</span>    <span class='comment'># Removes the last position on the pstack, or returns nil if the pstack is empty.
</span>    <span class='comment'># @return [Nil] empty pstack
</span>    <span class='comment'># @return [True] if operation was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_pop'>pop</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method chop
</span>    <span class='comment'># Removes the first position on the pstack, or returns nil if the pstack is empty.
</span>    <span class='comment'># @return [Nil] empty pstack
</span>    <span class='comment'># @return [True] if operation was successful
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_chop'>chop</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method push (element)
</span>    <span class='comment'># Adds an position with and element to the beginning of the pstack. Shifts and makes consistent
</span>    <span class='comment'># the remaining of the pstack.
</span>    <span class='comment'># @param [SimpleContent, QuoteContent] element any element
</span>    <span class='comment'># @return [Boolean]    
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_element'>element</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>else</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
      
        <span class='comment'># @!method append(element)
</span>    <span class='comment'># Adds an position with and element to the end of the pstack. Makes consistent the pstack.
</span>    <span class='comment'># @param [SimpleContent, QuoteContent] element any element
</span>    <span class='comment'># @return [Boolean]             
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_append'>append</span> <span class='lparen'>(</span><span class='id identifier rubyid_element'>element</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_last_pos'>last_pos</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='id identifier rubyid_last_pos'>last_pos</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method inactivate_pstack
</span>    <span class='comment'># Inactivates all the positions of this story.
</span>    <span class='comment'># @return [True] no matter what, humph.
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_inactivate_pstack'>inactivate_pstack</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_inactivate'>inactivate</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method activate_pstack
</span>    <span class='comment'># Activates all the positions of this story.
</span>    <span class='comment'># @return [True] no matter what, humph.
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_activate_pstack'>activate_pstack</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_activate'>activate</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    <span class='comment'>#@!endgroup
</span>    
    <span class='comment'>#@!group Content Aggregation
</span>        
    <span class='comment'># @!method get_similar_stories
</span>    <span class='comment'># Alias for self.relations
</span>    <span class='comment'># @return [ActiveCollection] a collection of all the stories tied to self
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_similar_stories'>get_similar_stories</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span>
    <span class='kw'>end</span>
                
    <span class='comment'># @!method get_citations
</span>    <span class='comment'># Returns and array of all the citations that are attached through positions.
</span>    <span class='comment'># @return [Array] all the citations associated through positions
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_get_citations'>get_citations</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_simple_content_citations'>simple_content_citations</span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_quote_content_citations'>quote_content_citations</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method new_similar_story(story_id_to_connect_to)
</span>            <span class='comment'># Creates a new tie between the parent story and a passed story id.
</span>    <span class='comment'># @param [Integer] story_id_to_connect_to is the story id to link to
</span>    <span class='comment'># @return [Boolean] true if save is successful, false if save is unsuccessful, if similar
</span>    <span class='comment'>#    story is already a similiar story, or if similiar story and self are the same
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_new_similar_story'>new_similar_story</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='rparen'>)</span>
        <span class='comment'># if the param is the same as self, or if param is aready connected to self
</span>        <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:tie_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>!=</span> <span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span> <span class='kw'>and</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='label'>tie_id:</span> <span class='id identifier rubyid_story_id_to_connect_to'>story_id_to_connect_to</span><span class='comma'>,</span> <span class='label'>tie_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Story</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>else</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># @!method remove_similar_story(story_id_to_remove)
</span>    <span class='comment'># Destroys the connection between self and the similar story
</span>    <span class='comment'># @param [Integer] story_id_to_remove the id of the tied story
</span>    <span class='comment'># @return [Boolean] true if the destroyed, false if not
</span>    <span class='kw'>def</span> <span class='id identifier rubyid_remove_similar_story'>remove_similar_story</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:tie_id</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='rparen'>)</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='const'>Relation</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>story_id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>tie_id:</span> <span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='comma'>,</span> <span class='label'>tie_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Story</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
        <span class='kw'>else</span>
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='comment'>#@!endgroup        
</span>       
<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:age</span><span class='comma'>,</span> <span class='symbol'>:freshness</span><span class='comma'>,</span> <span class='symbol'>:get_date_created</span><span class='comma'>,</span> <span class='symbol'>:get_date_updated</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:filed_under?</span><span class='comma'>,</span> <span class='symbol'>:get_subject</span><span class='comma'>,</span> <span class='symbol'>:about</span><span class='comma'>,</span> <span class='symbol'>:set_subject</span><span class='comma'>,</span> <span class='symbol'>:set_section</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_active_headline</span><span class='comma'>,</span> <span class='symbol'>:get_active_headline_id</span><span class='comma'>,</span> <span class='symbol'>:active_headline_age</span><span class='comma'>,</span> <span class='symbol'>:active_headline_freshness</span><span class='comma'>,</span> <span class='symbol'>:set_active_headline</span><span class='comma'>,</span> <span class='symbol'>:new_headline</span><span class='comma'>,</span> <span class='symbol'>:headlines_oldest_to_youngest</span><span class='comma'>,</span> <span class='symbol'>:headlines_youngest_to_oldest</span><span class='comma'>,</span> <span class='symbol'>:oldest_headline</span><span class='comma'>,</span> <span class='symbol'>:youngest_headline</span><span class='comma'>,</span> <span class='symbol'>:freshest_headline</span><span class='comma'>,</span> <span class='symbol'>:stalest_headline</span><span class='comma'>,</span> <span class='symbol'>:headlines_by_freshness</span><span class='comma'>,</span> <span class='symbol'>:headlines_by_staleness</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_active_leadline</span><span class='comma'>,</span> <span class='symbol'>:get_active_leadline_id</span><span class='comma'>,</span> <span class='symbol'>:active_leadline_age</span><span class='comma'>,</span> <span class='symbol'>:active_leadline_freshness</span><span class='comma'>,</span> <span class='symbol'>:set_active_leadline</span><span class='comma'>,</span> <span class='symbol'>:new_leadline</span><span class='comma'>,</span> <span class='symbol'>:leadlines_oldest_to_youngest</span><span class='comma'>,</span> <span class='symbol'>:leadlines_youngest_to_oldest</span><span class='comma'>,</span> <span class='symbol'>:oldest_leadline</span><span class='comma'>,</span> <span class='symbol'>:youngest_leadline</span><span class='comma'>,</span> <span class='symbol'>:freshest_leadline</span><span class='comma'>,</span> <span class='symbol'>:stalest_leadline</span><span class='comma'>,</span> <span class='symbol'>:leadlines_by_freshness</span><span class='comma'>,</span> <span class='symbol'>:leadlines_by_staleness</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:get_active_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_active_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:get_inactive_pstack_forwards</span><span class='comma'>,</span> <span class='symbol'>:get_inactive_pstack_backwards</span><span class='comma'>,</span> <span class='symbol'>:pop</span><span class='comma'>,</span> <span class='symbol'>:chop</span><span class='comma'>,</span> <span class='symbol'>:push</span><span class='comma'>,</span> <span class='symbol'>:append</span><span class='comma'>,</span> <span class='symbol'>:set_pstack_order</span><span class='comma'>,</span> <span class='symbol'>:is_pstack_consistent?</span><span class='comma'>,</span> <span class='symbol'>:make_pstack_consistent</span><span class='comma'>,</span> <span class='symbol'>:shift</span><span class='comma'>,</span> <span class='symbol'>:inactivate_pstack</span><span class='comma'>,</span> <span class='symbol'>:activate_pstack</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:get_citations</span>

<span class='id identifier rubyid_public'>public</span> <span class='symbol'>:new_similar_story</span><span class='comma'>,</span> <span class='symbol'>:remove_similar_story</span><span class='comma'>,</span> <span class='symbol'>:get_similar_stories</span>
        
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="activate_pstack-instance_method">
  
    - (<tt>True</tt>) <strong>activate_pstack</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Activates all the positions of this story.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>True</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>no matter what, humph.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


640
641
642
643
644
645</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 640</span>

<span class='kw'>def</span> <span class='id identifier rubyid_activate_pstack'>activate_pstack</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
        <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_activate'>activate</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="active_headline_age-instance_method">
  
    - (<tt>String</tt>) <strong>active_headline_age</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The age of the active headline. Time from creation until now.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the age in words</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


213
214
215</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 213</span>

<span class='kw'>def</span> <span class='id identifier rubyid_active_headline_age'>active_headline_age</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_age'>age</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="active_headline_freshness-instance_method">
  
    - (<tt>String</tt>) <strong>active_headline_freshness</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The freshness of the active headline. From last updated until now.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the freshness in words</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 220</span>

<span class='kw'>def</span> <span class='id identifier rubyid_active_headline_freshness'>active_headline_freshness</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freshness'>freshness</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="active_leadline_age-instance_method">
  
    - (<tt>String</tt>) <strong>active_leadline_age</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The age of the active leadline. Time from creation until now.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the age in words</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


318
319
320</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 318</span>

<span class='kw'>def</span> <span class='id identifier rubyid_active_leadline_age'>active_leadline_age</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_age'>age</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="active_leadline_freshness-instance_method">
  
    - (<tt>String</tt>) <strong>active_leadline_freshness</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The freshness of the active leadline. From last updated until now.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the freshness in words</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


325
326
327</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 325</span>

<span class='kw'>def</span> <span class='id identifier rubyid_active_leadline_freshness'>active_leadline_freshness</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freshness'>freshness</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="age-instance_method">
  
    - (<tt>String</tt>) <strong>age</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The age in words. Time from creation until now.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>cit.age =&gt; &quot;about 16 hours&quot;</code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 139</span>

<span class='kw'>def</span> <span class='id identifier rubyid_age'>age</span>
    <span class='id identifier rubyid_time_ago_in_words'>time_ago_in_words</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_date_created'>get_date_created</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="append-instance_method">
  
    - (<tt>Boolean</tt>) <strong>append</strong>(element) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds an position with and element to the end of the pstack. Makes
consistent the pstack.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>element</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="SimpleContent.html" title="SimpleContent (class)">SimpleContent</a></span></tt>, <tt><span class='object_link'><a href="QuoteContent.html" title="QuoteContent (class)">QuoteContent</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>any element</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 611</span>

</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="chop-instance_method">
  
    - (<tt>Nil</tt>, <tt>True</tt>) <strong>chop</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Removes the first position on the pstack, or returns nil if the pstack is
empty.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>empty pstack</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>True</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if operation was successful</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


586
587
588
589
590
591
592
593</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 586</span>

<span class='kw'>def</span> <span class='id identifier rubyid_chop'>chop</span>
    <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>else</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="filed_under?-instance_method">
  
    - (<tt>String</tt>) <strong>filed_under?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>What Section is this Story filed under?</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the section title of the owning Section</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


180
181
182</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 180</span>

<span class='kw'>def</span> <span class='id identifier rubyid_filed_under?'>filed_under?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="freshest_headline-instance_method">
  
    - (<tt>String</tt>) <strong>freshest_headline</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the most recently updated headline.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the freshest headline</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


273
274
275</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 273</span>

<span class='kw'>def</span> <span class='id identifier rubyid_freshest_headline'>freshest_headline</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="freshest_leadline-instance_method">
  
    - (<tt>String</tt>) <strong>freshest_leadline</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the most recently updated leadline.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the freshest leadline</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


379
380
381</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 379</span>

<span class='kw'>def</span> <span class='id identifier rubyid_freshest_leadline'>freshest_leadline</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="freshness-instance_method">
  
    - (<tt>String</tt>) <strong>freshness</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The freshness in words. Time from last updated until now.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>hl.freshness =&gt; &quot;6 minutes&quot;</code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 148</span>

<span class='kw'>def</span> <span class='id identifier rubyid_freshness'>freshness</span>
    <span class='id identifier rubyid_time_ago_in_words'>time_ago_in_words</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_date_updated'>get_date_updated</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_active_headline-instance_method">
  
    - (<tt>String</tt>) <strong>get_active_headline</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The active headline of the story.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 199</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_active_headline'>get_active_headline</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_active_headline_id-instance_method">
  
    - (<tt>Integer</tt>) <strong>get_active_headline_id</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The active headline id of the story.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the id of the active headline</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 206</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_active_headline_id'>get_active_headline_id</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_active_leadline-instance_method">
  
    - (<tt>String</tt>) <strong>get_active_leadline</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The active leadline of the story.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


304
305
306</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 304</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_active_leadline'>get_active_leadline</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_active_leadline_id-instance_method">
  
    - (<tt>Integer</tt>) <strong>get_active_leadline_id</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The active leadline id of the story.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the id of the active leadline</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


311
312
313</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 311</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_active_leadline_id'>get_active_leadline_id</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_active_pstack_backwards-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>get_active_pstack_backwards</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The pstack with only active positions, in descending order.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


431
432
433</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 431</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_active_pstack_backwards'>get_active_pstack_backwards</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_active_pstack_forwards-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>get_active_pstack_forwards</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The pstack with only active positions, in ascending order.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


424
425
426</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 424</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_active_pstack_forwards'>get_active_pstack_forwards</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_citations-instance_method">
  
    - (<tt>Array</tt>) <strong>get_citations</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns and array of all the citations that are attached through positions.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>all the citations associated through positions</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


660
661
662</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 660</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_citations'>get_citations</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_simple_content_citations'>simple_content_citations</span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_quote_content_citations'>quote_content_citations</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_date_created-instance_method">
  
    - (<tt>TimeWithZone</tt>) <strong>get_date_created</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the timedate when the citation was created</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>kat.get_date_created =&gt; Mon, 09 Feb 2015 15:18:20 UTC +00:00</code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>TimeWithZone</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the timedate when the citation was created</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


122
123
124</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 122</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_date_created'>get_date_created</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_date_updated-instance_method">
  
    - (<tt>TimeWithZone</tt>) <strong>get_date_updated</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the timedate when the citation was created</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>kat.get_date_updated =&gt; Mon, 09 Feb 2015 15:31:29 UTC +00:00</code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>TimeWithZone</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the timedate when the citation was created</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 130</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_date_updated'>get_date_updated</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_updated_at'>updated_at</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_inactive_pstack_backwards-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>get_inactive_pstack_backwards</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The pstack with only inactive positions, in descending order.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


445
446
447</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 445</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_inactive_pstack_backwards'>get_inactive_pstack_backwards</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_inactive_pstack_forwards-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>get_inactive_pstack_forwards</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The pstack with only inactive positions, in ascending order.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


438
439
440</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 438</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_inactive_pstack_forwards'>get_inactive_pstack_forwards</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_pstack_backwards-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>get_pstack_backwards</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The whole pstack in descending order.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


417
418
419</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 417</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_pstack_backwards'>get_pstack_backwards</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_pstack_forwards-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>get_pstack_forwards</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The whole pstack in ascending order.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


410
411
412</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 410</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_pstack_forwards'>get_pstack_forwards</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_similar_stories-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>get_similar_stories</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Alias for self.relations</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a collection of all the stories tied to self</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


653
654
655</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 653</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_similar_stories'>get_similar_stories</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_subject-instance_method">
  
    - (<tt>String</tt>) <strong>get_subject</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='about-instance_method'>about</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the subject of the story. A short description of the story, helping
authors.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 159</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_subject'>get_subject</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="headlines_by_freshness-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>headlines_by_freshness</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns all headlines from the freshest to the stalest</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


287
288
289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 287</span>

<span class='kw'>def</span> <span class='id identifier rubyid_headlines_by_freshness'>headlines_by_freshness</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>    
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="headlines_by_staleness-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>headlines_by_staleness</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns all headlines from the stalest to the freshest</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 294</span>

<span class='kw'>def</span> <span class='id identifier rubyid_headlines_by_staleness'>headlines_by_staleness</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="headlines_oldest_to_youngest-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>headlines_oldest_to_youngest</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return all headlines in order from the oldest to the youngest</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


245
246
247</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 245</span>

<span class='kw'>def</span> <span class='id identifier rubyid_headlines_oldest_to_youngest'>headlines_oldest_to_youngest</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="headlines_youngest_to_oldest-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>headlines_youngest_to_oldest</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return all headlines from the youngest to oldest</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


252
253
254</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 252</span>

<span class='kw'>def</span> <span class='id identifier rubyid_headlines_youngest_to_oldest'>headlines_youngest_to_oldest</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>        
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inactivate_pstack-instance_method">
  
    - (<tt>True</tt>) <strong>inactivate_pstack</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Inactivates all the positions of this story.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>True</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>no matter what, humph.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


630
631
632
633
634
635</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 630</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inactivate_pstack'>inactivate_pstack</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
        <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_inactivate'>inactivate</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="is_pstack_consistent?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>is_pstack_consistent?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Determines if the pstack is in compact order.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>consistent: [1, 2, 3, 4, 5]
consistent: [15, 16, 17, 18, 19]
inconsistent: [3, 6, 9, 12, 34]
inconsistent: [3, 3, 3, 4, 5] (this shouldn&#39;t occur if validation is on)</code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>answer to your question.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


457
458
459
460
461
462
463</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 457</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is_pstack_consistent?'>is_pstack_consistent?</span>
    <span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
    <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
    <span class='id identifier rubyid_len'>len</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    
    <span class='lparen'>(</span><span class='id identifier rubyid_last'>last</span> <span class='op'>-</span> <span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='id identifier rubyid_len'>len</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="leadlines_by_freshness-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>leadlines_by_freshness</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns all leadlines from the freshest to the stalest</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


393
394
395</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 393</span>

<span class='kw'>def</span> <span class='id identifier rubyid_leadlines_by_freshness'>leadlines_by_freshness</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>    
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="leadlines_by_staleness-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>leadlines_by_staleness</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns all leadlines from the stalest to the freshest</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


400
401
402</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 400</span>

<span class='kw'>def</span> <span class='id identifier rubyid_leadlines_by_staleness'>leadlines_by_staleness</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="leadlines_oldest_to_youngest-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>leadlines_oldest_to_youngest</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return all leadlines in order from the oldest to the youngest</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


351
352
353</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 351</span>

<span class='kw'>def</span> <span class='id identifier rubyid_leadlines_oldest_to_youngest'>leadlines_oldest_to_youngest</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="leadlines_youngest_to_oldest-instance_method">
  
    - (<tt>ActiveCollection</tt>) <strong>leadlines_youngest_to_oldest</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return all leadlines from the youngest to oldest</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveCollection</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


358
359
360</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 358</span>

<span class='kw'>def</span> <span class='id identifier rubyid_leadlines_youngest_to_oldest'>leadlines_youngest_to_oldest</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>        
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="make_pstack_consistent-instance_method">
  
    - (<tt>Boolean</tt>) <strong>make_pstack_consistent</strong>(start = 1) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Makes the pstack consistent. This is really a helper utility, may never
needs to be used, and especially not outside the context of this object.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_story'>story</span><span class='period'>.</span><span class='id identifier rubyid_get_pstack_forwards'>get_pstack_forwards</span> <span class='comment'>#=&gt; [1, 2, 5, 9, 23]
</span><span class='id identifier rubyid_story'>story</span><span class='period'>.</span><span class='id identifier rubyid_is_consistent?'>is_consistent?</span> <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_story'>story</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span> <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_story'>story</span><span class='period'>.</span><span class='id identifier rubyid_get_pstack_forwards'>get_pstack_forwards</span> <span class='comment'>#=&gt; [1, 2, 3, 4, 5]</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>start</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>what number will the first position start at? default = 1</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>returns true on complete returns false if the param was 0 or 1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 476</span>

<span class='kw'>def</span> <span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>&lt;=</span> <span class='int'>0</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
    
    <span class='id identifier rubyid_first'>first</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
    
    <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_is_pstack_consistent?'>is_pstack_consistent?</span>
        <span class='comment'># True it&#39;s in order, then do we need to shift it?
</span>        <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span> <span class='op'>==</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
            <span class='comment'># nothing to do
</span>            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span> <span class='op'>!=</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
            <span class='comment'># TODO: shift it
</span>            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>-</span> <span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>else</span> <span class='comment'># not consistent
</span>        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='comment'># b/c each story.positions.position needs to be uniqe, we run into the issue of 
</span>            <span class='comment'># Validation failed: Position has already been taken
</span>            <span class='comment'># so, we&#39;ll set the order in negative numbers and just flip their signs
</span>            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='id identifier rubyid_start'>start</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>end</span>
            <span class='comment'># now to switch back to positive positions
</span>        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> 
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_headline-instance_method">
  
    - (<tt>Boolean</tt>) <strong>new_headline</strong>(new_headline, make_active = true) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new headline for this story. make_active true/false, true makes</p>

<pre class="code ruby"><code class="ruby">this new headline the active one.</code></pre>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if save is successful</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


236
237
238
239
240</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 236</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new_headline'>new_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_new_headline'>new_headline</span><span class='comma'>,</span> <span class='id identifier rubyid_make_active'>make_active</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_kat'>kat</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>content:</span> <span class='id identifier rubyid_new_headline'>new_headline</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_make_active'>make_active</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_active_headline'>set_active_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_kat'>kat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>false</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_leadline-instance_method">
  
    - (<tt>Boolean</tt>) <strong>new_leadline</strong>(new_leadline, make_active = true) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new leadline for this story. make_active true/false, true makes</p>

<pre class="code ruby"><code class="ruby">this new leadline the active one.</code></pre>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if save is successful</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


342
343
344
345
346</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 342</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='comma'>,</span> <span class='id identifier rubyid_make_active'>make_active</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_kat'>kat</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>content:</span> <span class='id identifier rubyid_new_leadline'>new_leadline</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_make_active'>make_active</span> <span class='op'>?</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_active_leadline'>set_active_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_kat'>kat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>false</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_similar_story-instance_method">
  
    - (<tt>Boolean</tt>) <strong>new_similar_story</strong>(story_id_to_connect_to) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns true if save is successful, false if save is unsuccessful, if
similar story is already a similiar story, or if similiar story and self
are the same</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>story_id_to_connect_to</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>is the story id to link to</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if save is successful, false if save is unsuccessful, if similar story
is already a similiar story, or if similiar story and self are the same</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 664</span>

</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="oldest_headline-instance_method">
  
    - (<tt>String</tt>) <strong>oldest_headline</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the first created headline.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the oldest headline</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


259
260
261</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 259</span>

<span class='kw'>def</span> <span class='id identifier rubyid_oldest_headline'>oldest_headline</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="oldest_leadline-instance_method">
  
    - (<tt>String</tt>) <strong>oldest_leadline</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the first created leadline.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the oldest leadline</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


365
366
367</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 365</span>

<span class='kw'>def</span> <span class='id identifier rubyid_oldest_leadline'>oldest_leadline</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pop-instance_method">
  
    - (<tt>Nil</tt>, <tt>True</tt>) <strong>pop</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Removes the last position on the pstack, or returns nil if the pstack is
empty.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>empty pstack</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>True</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if operation was successful</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


573
574
575
576
577
578
579
580</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 573</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pop'>pop</span>
    <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>else</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>position:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="push-instance_method">
  
    - (<tt>Boolean</tt>) <strong>push</strong>(element) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds an position with and element to the beginning of the pstack. Shifts
and makes consistent the remaining of the pstack.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>element</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="SimpleContent.html" title="SimpleContent (class)">SimpleContent</a></span></tt>, <tt><span class='object_link'><a href="QuoteContent.html" title="QuoteContent (class)">QuoteContent</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>any element</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


600
601
602
603
604
605
606
607
608
609</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 600</span>

<span class='kw'>def</span> <span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_element'>element</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>else</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make_pstack_consistent'>make_pstack_consistent</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>element_id:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>element_type:</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_similar_story-instance_method">
  
    - (<tt>Boolean</tt>) <strong>remove_similar_story</strong>(story_id_to_remove) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Destroys the connection between self and the similar story</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>story_id_to_remove</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the id of the tied story</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if the destroyed, false if not</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


683
684
685
686
687
688
689
690</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 683</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_similar_story'>remove_similar_story</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:tie_id</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_relations'>relations</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='const'>Relation</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>story_id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>tie_id:</span> <span class='id identifier rubyid_story_id_to_remove'>story_id_to_remove</span><span class='comma'>,</span> <span class='label'>tie_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Story</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
    <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_active_headline-instance_method">
  
    - (<tt>Boolean</tt>) <strong>set_active_headline</strong>(id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set the active to a headline that already exists using its id. And saves it
to the database.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the save was successful</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227
228
229
230</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 227</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_active_headline'>set_active_headline</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_headline_id'>active_headline_id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>   
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_active_leadline-instance_method">
  
    - (<tt>Boolean</tt>) <strong>set_active_leadline</strong>(id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set the active to a leadline that already exists using its id. And saves it
to the database.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the save was successful</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


333
334
335
336</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 333</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_active_leadline'>set_active_leadline</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_leadline_id'>active_leadline_id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>   
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_pstack_order-instance_method">
  
    - (<tt>Nil</tt>, <tt>True</tt>) <strong>set_pstack_order</strong>(order) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Reorders the pstack in the order of an array of position ids. First id in
the array becomes the first position, the second id becomes the second, and
so on.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if there isn&#39;t the same number of elements in the array and pstack</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the pstack position id&#39;s do not include exactly the id&#39;s in the
array</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>True</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if successful</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 540</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_pstack_order'>set_pstack_order</span><span class='lparen'>(</span><span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
        <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>else</span> 
        <span class='comment'>#determine if the supplied order ids are actually owned by the story
</span>        <span class='id identifier rubyid_pstack'>pstack</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span>
            <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_pstack'>pstack</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
                <span class='kw'>return</span> <span class='kw'>false</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='comment'># set the pstack to the order
</span>        <span class='id identifier rubyid_position_order'>position_order</span> <span class='op'>=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Position</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_position_order'>position_order</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
            <span class='id identifier rubyid_position_order'>position_order</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>end</span>
        <span class='comment'># now to switch back to positive positions
</span>        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reload'>reload</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> 
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_section-instance_method">
  
    - (<tt>Boolean</tt>) <strong>set_section</strong>(section_id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the section_id of this story</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>section_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the save was successful</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190
191</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 188</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_section'>set_section</span><span class='lparen'>(</span><span class='id identifier rubyid_section_id'>section_id</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_section_id'>section_id</span> <span class='op'>=</span> <span class='id identifier rubyid_section_id'>section_id</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_subject-instance_method">
  
    - (<tt>Boolean</tt>) <strong>set_subject</strong>(new_subject) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the subject to a new subject and then saves.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>new_subject</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the save was successful</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 172</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_subject'>set_subject</span> <span class='lparen'>(</span><span class='id identifier rubyid_new_subject'>new_subject</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_new_subject'>new_subject</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shift-instance_method">
  
    - (<tt>Object</tt>) <strong>shift</strong>(modifier) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shift all the positions in the pstack by the modifier. Irregardless of
activeness of the positions. modifier=1 would shift the pstack down 1,
modifier=-1 would shift it up 1</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_story'>story</span><span class='period'>.</span><span class='id identifier rubyid_get_pstack_forwards'>get_pstack_forwards</span> <span class='comment'>#=&gt; [1, 2, 3, 4, 5]
</span><span class='id identifier rubyid_story'>story</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>
<span class='id identifier rubyid_story'>story</span><span class='period'>.</span><span class='id identifier rubyid_get_pstack_forwards'>get_pstack_forwards</span> <span class='comment'>#=&gt; [11, 12, 13, 14, 15]</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>modifier</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the number to shift the positions</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


519
520
521
522
523
524
525
526
527
528
529
530
531
532</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 519</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_modifier'>modifier</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_modifier'>modifier</span> <span class='op'>&gt;</span> <span class='int'>0</span> 
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_modifier'>modifier</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
        <span class='kw'>end</span>            
    <span class='kw'>elsif</span> <span class='id identifier rubyid_modifier'>modifier</span> <span class='op'>&lt;</span> <span class='int'>0</span> 
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_positions'>positions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_modifier'>modifier</span>
            <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
        <span class='kw'>end</span>    
    <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stalest_headline-instance_method">
  
    - (<tt>String</tt>) <strong>stalest_headline</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the oldest updated headline.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the stalest headline</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


280
281
282</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 280</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stalest_headline'>stalest_headline</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stalest_leadline-instance_method">
  
    - (<tt>String</tt>) <strong>stalest_leadline</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the oldest updated leadline.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the stalest leadline</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


386
387
388</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 386</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stalest_leadline'>stalest_leadline</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>updated_at:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="youngest_headline-instance_method">
  
    - (<tt>String</tt>) <strong>youngest_headline</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the last created headline.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the youngest headline</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


266
267
268</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 266</span>

<span class='kw'>def</span> <span class='id identifier rubyid_youngest_headline'>youngest_headline</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_headlines'>headlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_headline'>get_headline</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="youngest_leadline-instance_method">
  
    - (<tt>String</tt>) <strong>youngest_leadline</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the last created leadline.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the youngest leadline</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


372
373
374</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/story.rb', line 372</span>

<span class='kw'>def</span> <span class='id identifier rubyid_youngest_leadline'>youngest_leadline</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_leadlines'>leadlines</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_get_leadline'>get_leadline</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu Feb 19 08:53:33 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.1).
</div>

  </body>
</html>